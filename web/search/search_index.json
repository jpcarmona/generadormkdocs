{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Bienvenido al Rinc\u00f3n Vac\u00edo \u00b6 Acceso remoto a servidor Postgresql En esta ocasi\u00f3n veremos de forma sencilla conectarnos a un servidor remoto de postgresql. Instalaci\u00f3n y uso de herramienta de seguridad Fail2Ban en Debian Stretch 9.5 Vamos a ver esta vez una buena herramienta que funcionar\u00e1 como Sistema de Detecci\u00f3n de Intrusos (IDS o HIDS), Fail2ban nos permite ver los accesos o intentos de accesos en el sistema o en servicios del sistema y adem\u00e1s podremos aplicar medidas. Funciona leyendo ficheros de logs y aplicando regals de iptables. Instalaci\u00f3n Oracle Database 12c versi\u00f3n 2 (12.2.0) Enterprise Edition en Debian Jessie 8.11 Y aqu\u00ed llega lo que no suele ser visto con Oracle, la instalaci\u00f3n de su base de datos en un sistema que no est\u00e1 soportado por este software privativo en un Debian. As\u00ed es, aqu\u00ed descubrimeros que entresijos tiene realizar esta instalaci\u00f3n un poco dificultosa en varios pasos. PL/SQL vs PL/PGSQL En este post veremos las principales diferencias entre la programaci\u00f3n en PL/SQL de Oracle y PL/PGSQL de Postgres. Kernel Linux En este post veremos como configurar el kernel linux y adaptarlo a las necesidades m\u00ednimas de nuestra m\u00e1quina. MkDocs En este post veremos como crear p\u00e1ginas est\u00e1ticas con MkDocs en un entorno Debian Stretch y luego desplegarlas con GitHubPages .","title":"Inicio"},{"location":"#bienvenido-al-rincon-vacio","text":"Acceso remoto a servidor Postgresql En esta ocasi\u00f3n veremos de forma sencilla conectarnos a un servidor remoto de postgresql. Instalaci\u00f3n y uso de herramienta de seguridad Fail2Ban en Debian Stretch 9.5 Vamos a ver esta vez una buena herramienta que funcionar\u00e1 como Sistema de Detecci\u00f3n de Intrusos (IDS o HIDS), Fail2ban nos permite ver los accesos o intentos de accesos en el sistema o en servicios del sistema y adem\u00e1s podremos aplicar medidas. Funciona leyendo ficheros de logs y aplicando regals de iptables. Instalaci\u00f3n Oracle Database 12c versi\u00f3n 2 (12.2.0) Enterprise Edition en Debian Jessie 8.11 Y aqu\u00ed llega lo que no suele ser visto con Oracle, la instalaci\u00f3n de su base de datos en un sistema que no est\u00e1 soportado por este software privativo en un Debian. As\u00ed es, aqu\u00ed descubrimeros que entresijos tiene realizar esta instalaci\u00f3n un poco dificultosa en varios pasos. PL/SQL vs PL/PGSQL En este post veremos las principales diferencias entre la programaci\u00f3n en PL/SQL de Oracle y PL/PGSQL de Postgres. Kernel Linux En este post veremos como configurar el kernel linux y adaptarlo a las necesidades m\u00ednimas de nuestra m\u00e1quina. MkDocs En este post veremos como crear p\u00e1ginas est\u00e1ticas con MkDocs en un entorno Debian Stretch y luego desplegarlas con GitHubPages .","title":"Bienvenido al Rinc\u00f3n Vac\u00edo"},{"location":"about/","text":"Sic omnes lintea \u00b6 Memorant quem forti \u00b6 Lorem markdownum florentia quam Camenis hoc occidat cetera: unda aquis nutritur edidit? Cum inmunis terra insidias: aures nec, aquas animi ferarum oppositas lunae recentibus cuncta cornum , sanguine. Constitit quas, nec ille materiaque gurgite torpor ego cruore premunt ostendit deus nec quid ait satyri sit. Velamine harundinis perveni. Aera non Enaesimus vineta nefas oppressos Venus comites submovit nomenque quid, esse iste incubat quid patientia crinem. 1 2 3 4 5 6 7 8 9 10 var internetSata = lunDelete; var compatible = io / 4 + urlNon + mamp; if (keystroke_ping != host) { telecommunications_port_backside.t(system_mp, wimaxSimplex); } else { barcraft = 2; hardMouseGraymail = marketingBoolean * mount_wildcard - network; } redundancyBusVertical *= module; multiLionCompile = dual_cpc * camelcase; Huc nefandam natos habebat cornibus potat \u00b6 Voluisti utque serpentis et hunc, ut atque genetrici tauri sum Phoebeius abit. Totum scit quoniam? Ignes causas, substrictaque tincta suppositosque fortuna serius evolvere cunctis quaerunt verba, reverentia nec Leucothoeque circum moenia repulsa. Terebrata fallaci ferebat ille humano dea tarde calido ab annis: seque dixit Actaeona formosius genitis. Crudelis veteris speciosam Nerea manu littera invitum Erinys, volui antrum: viscera confertque hostem rogabam, arcum. Signum est saepe angi Pollice tenent orantemque vertice lana Parcum est saepe saevorum faciem luctus habuit Una rite illa sex sed humanas umente Perque rotat duos per se silentia adhuc Recenti caeruleas et vilior costas et icta \u00b6 Nulla praelata cum Pontum dixit, dederat. Carpebat puellae ; aspera nomine sacris, pater fecit contrarius Indigetem ipse natura exponit ictus; tunc. Populusque militiam hoc vivum et Scythiae inposito undas vitae casus tecta iterque mutarent aliquod. Quam iuvat cape me, in quattuor valvis, Venere Saturnia artus Letoidos invergens quique procul. Honores scissaeque herbis perque qualis \u00b6 Alteraque feres et Iove tamen tantum Nixique, idem die suffundit velox dexteriore agentem huic dabat pectoris intus principio nihil. Destrinxit viribus, positas, addit menti. Data omnis Aglauros maesta? In exhortari, tuos quoque aliquid Austro, non me dubito pigre sors extemplo nomina, lactis sonum? Quaerite quid iuvat \u00b6 Publica exhortor proximitas lumine eadem: et igne cupidine lateri Numitorque avidae vident duxerat, venefica nec additur vanam Alcmene. Non suum Tellus precari acto sed lassa nunc errat illum se ego Iuppiter. Recenti parili arces squamis, corda aestu tendit exorata structa mihi; fletumque peperisse quibus illa , pependit. Lacrimas imas virtute suae partes et Aegides tetigit, hanc via certo, data mixtis haec faciemque. Adspicit Dicta tostos extulit pressum faciat at expers iamque me ripae in parvumque , certa nefandam? Videre ab ille advertitur, formam? Agna praestat , Arcades memori et seduxit duri commune inposuit, cornua.","title":"Sobre m\u00ed"},{"location":"about/#sic-omnes-lintea","text":"","title":"Sic omnes lintea"},{"location":"about/#memorant-quem-forti","text":"Lorem markdownum florentia quam Camenis hoc occidat cetera: unda aquis nutritur edidit? Cum inmunis terra insidias: aures nec, aquas animi ferarum oppositas lunae recentibus cuncta cornum , sanguine. Constitit quas, nec ille materiaque gurgite torpor ego cruore premunt ostendit deus nec quid ait satyri sit. Velamine harundinis perveni. Aera non Enaesimus vineta nefas oppressos Venus comites submovit nomenque quid, esse iste incubat quid patientia crinem. 1 2 3 4 5 6 7 8 9 10 var internetSata = lunDelete; var compatible = io / 4 + urlNon + mamp; if (keystroke_ping != host) { telecommunications_port_backside.t(system_mp, wimaxSimplex); } else { barcraft = 2; hardMouseGraymail = marketingBoolean * mount_wildcard - network; } redundancyBusVertical *= module; multiLionCompile = dual_cpc * camelcase;","title":"Memorant quem forti"},{"location":"about/#huc-nefandam-natos-habebat-cornibus-potat","text":"Voluisti utque serpentis et hunc, ut atque genetrici tauri sum Phoebeius abit. Totum scit quoniam? Ignes causas, substrictaque tincta suppositosque fortuna serius evolvere cunctis quaerunt verba, reverentia nec Leucothoeque circum moenia repulsa. Terebrata fallaci ferebat ille humano dea tarde calido ab annis: seque dixit Actaeona formosius genitis. Crudelis veteris speciosam Nerea manu littera invitum Erinys, volui antrum: viscera confertque hostem rogabam, arcum. Signum est saepe angi Pollice tenent orantemque vertice lana Parcum est saepe saevorum faciem luctus habuit Una rite illa sex sed humanas umente Perque rotat duos per se silentia adhuc","title":"Huc nefandam natos habebat cornibus potat"},{"location":"about/#recenti-caeruleas-et-vilior-costas-et-icta","text":"Nulla praelata cum Pontum dixit, dederat. Carpebat puellae ; aspera nomine sacris, pater fecit contrarius Indigetem ipse natura exponit ictus; tunc. Populusque militiam hoc vivum et Scythiae inposito undas vitae casus tecta iterque mutarent aliquod. Quam iuvat cape me, in quattuor valvis, Venere Saturnia artus Letoidos invergens quique procul.","title":"Recenti caeruleas et vilior costas et icta"},{"location":"about/#honores-scissaeque-herbis-perque-qualis","text":"Alteraque feres et Iove tamen tantum Nixique, idem die suffundit velox dexteriore agentem huic dabat pectoris intus principio nihil. Destrinxit viribus, positas, addit menti. Data omnis Aglauros maesta? In exhortari, tuos quoque aliquid Austro, non me dubito pigre sors extemplo nomina, lactis sonum?","title":"Honores scissaeque herbis perque qualis"},{"location":"about/#quaerite-quid-iuvat","text":"Publica exhortor proximitas lumine eadem: et igne cupidine lateri Numitorque avidae vident duxerat, venefica nec additur vanam Alcmene. Non suum Tellus precari acto sed lassa nunc errat illum se ego Iuppiter. Recenti parili arces squamis, corda aestu tendit exorata structa mihi; fletumque peperisse quibus illa , pependit. Lacrimas imas virtute suae partes et Aegides tetigit, hanc via certo, data mixtis haec faciemque. Adspicit Dicta tostos extulit pressum faciat at expers iamque me ripae in parvumque , certa nefandam? Videre ab ille advertitur, formam? Agna praestat , Arcades memori et seduxit duri commune inposuit, cornua.","title":"Quaerite quid iuvat"},{"location":"blog/fail2ban/","text":"Instalaci\u00f3n y uso de herramienta de seguridad Fail2Ban en Debian Stretch 9.5 \u00b6 Vamos a ver esta vez una buena herramienta que funcionar\u00e1 como Sistema de Detecci\u00f3n de Intrusos (IDS o HIDS). Fail2ban nos permite ver los accesos o intentos de accesos en el sistema o en servicios del sistema y adem\u00e1s podremos aplicar medidas. Funciona leyendo ficheros de logs y aplicando reglas de iptables generalmente. Caracter\u00edsticas Fail2Ban \u00b6 Est\u00e1 desarrollado en Python3 y tiene las siguientes funcionalidades: Cliente/Servidor. Multiprocesamiento. Autodetecci\u00f3n del formato de la fecha. Soporte para bastantes servicios como ssh o apache. Soporte para realizar acciones como iptables o env\u00edo de correos. Compatible con SystemD y SystemV. Usa una base de datos SQLite3 para guardar los baneos. Definiciones \u00b6 Fail2Ban usa filter Son las expresiones regulares utilizadas para el \"parseo\" de los logs. action Son las acciones a realizar seg\u00fan los acontecimientos encontrados en los logs. jail Son un conjunto de filter y action utilizados independientemente por cada servicio denominado. Puede ser por ejemplo \"ssh\" o \"apache2\" o incluso variaciones de estas ya incluidas. Podemos crear filter , action y jail personalizados que veamos oportunos para nuestro sistema customizado. Configuraci\u00f3n inicial de la m\u00e1quina \u00b6 M\u00e1quina virtual con Vagrant y VirtualBox: \u00b6 Fichero Vagrantfile: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant . configure ( \"2\" ) do | config | config . vm . define \"nodo1\" do | nodo1 | config . vm . provider \"virtualbox\" do | vb | vb . name = \"jpfail\" end nodo1 . vm . box = \"debian/stretch64\" nodo1 . vm . hostname = \"jpfail\" nodo1 . vm . network \"public_network\" , bridge : \"wlan0\" , use_dhcp_assigned_default_route : true end end Arrancamos m\u00e1quina: \u00b6 1 vagrant up Accedemos mediante SSH: \u00b6 1 vagrant ssh Instalaci\u00f3n \u00b6 Actualizaci\u00f3n del sistema: \u00b6 1 2 sudo su - apt update && apt -y upgrade Requerimientos: \u00b6 Actualmente la \u00faltima versi\u00f3n de Fail2ban es la 0.9.6 . Esta versi\u00f3n requiere uno de los siguientes paquetes: Python 2.6 o superior. Python 3.2 o superior. PyPy. Instalamos Fail2Ban: \u00b6 1 apt -y install fail2ban Ficheros de configuraci\u00f3n \u00b6 Los ficheros de configuraci\u00f3n de Fail2Ban se encuentran en /etc/fail2ban . Tambi\u00e9n existe uno en /etc/default/fail2ban que configura el usuario que usar\u00e1 Fail2Ban que por defecto es \"root\" adem\u00e1s se podr\u00e1 configurar con opciones del arranque de esta herramienta. Generales \u00b6 /etc/fail2ban/fail2ban.conf \u00b6 Es la configuraci\u00f3n principal de Fail2Ban y en el se encuentra lo siguiente: 1 2 3 4 5 6 7 8 9 10 11 12 13 loglevel = INFO logtarget = /var/log/fail2ban.log syslogsocket = auto socket = /var/run/fail2ban/fail2ban.sock pidfile = /var/run/fail2ban/fail2ban.pid dbfile = /var/lib/fail2ban/fail2ban.sqlite3 dbpurgeage = 86400 Tambi\u00e9n podremos modificar estas configuraciones con el comando fail2ban-client que veremos m\u00e1s adelante. /etc/fail2ban/paths-*.conf \u00b6 Es la declaraci\u00f3n de los directorios de los logs principales usados con esta herramienta. FILTERS \u00b6 /etc/fail2ban/filter.d/*.conf \u00b6 Aqu\u00ed se encuentran las configuraciones de las expresiones regulares utilizadas para el parseo de logs en cada servicio o jail . Un ejemplo ser\u00eda por ejemplo el el fichero apache-common.conf : 1 2 3 [ DEFAULT ] _apache_error_client = \\[\\] \\[ ( :?error | \\S +: \\S + ) \\] ( \\[ pid \\d + ( : \\S + \\d + ) ? \\] ) ? \\[ client <HOST> ( : \\d { 1 ,5 }) ? \\] En el se ve la expresi\u00f3n regular que busca si ha habido alg\u00fan error con un cliente. ACTIONS \u00b6 /etc/fail2ban/action.d/*.conf \u00b6 Aqu\u00ed se encuentran las configuraciones de las acciones principales a realizar en caso de estar configurado en un servicio o jail . Un ejemplo ser\u00eda por ejemplo el el fichero iptables.conf : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 [ INCLUDES ] before = iptables-common.conf [ Definition ] actionstart = <iptables> -N f2b-<name> <iptables> -A f2b-<name> -j <returntype> <iptables> -I <chain> -p <protocol> --dport <port> -j f2b-<name> actionstop = <iptables> -D <chain> -p <protocol> --dport <port> -j f2b-<name> <iptables> -F f2b-<name> <iptables> -X f2b-<name> actioncheck = <iptables> -n -L <chain> | grep -q 'f2b-<name>[ \\t]' actionban = <iptables> -I f2b-<name> 1 -s <ip> -j <blocktype> actionunban = <iptables> -D f2b-<name> -s <ip> -j <blocktype> [ Init ] En este fichero se encuentran las acciones definidas a relizar si se usa esta action como comprobar las reglas \"iptables\", a\u00f1adir una regla, eliminarla, etc... JAILS \u00b6 /etc/fail2ban/jail.conf \u00b6 Es la configuraci\u00f3n principal de los JAILS . Aqu\u00ed se encuentran las configuraciones de todos los jails que se pueden usar pero que no estan activados por defecto y no se recomienda modificar. Un ejemplo son las configuraciones por defecto: 1 2 3 4 5 6 7 8 9 [ DEFAULT ] ignoreip = 127 .0.0.1/8 bantime = 600 findtime = 600 maxretry = 5 M\u00e1s abajo se definen las configuraciones de algunas actions y todos los jails que se pueden usar por defecto. /etc/fail2ban/jail.d/*.conf \u00b6 Existe un solo fichero que es /etc/fail2ban/jail.d/defaults-debian.conf . En el se configurar\u00e1 la activaci\u00f3n de los jails por defecto. 1 2 [ sshd ] enabled = true Por defecto solo est\u00e1 activado el jail de ssh. Scripts o comandos de Fail2Ban \u00b6 fail2ban-server \u00b6 Este arranca en segundo plano autom\u00e1ticamente al instalarse Fail2Ban y es el proceso principal. Opciones disponibles: 1 2 3 4 5 -b start in background -f start in foreground -s <FILE> socket path -p <FILE> pidfile path -x force execution of the server fail2ban-client \u00b6 Es el \"frontend\" y el que se comunica con el servidor envi\u00e1ndole \u00f3rdenes y configuraciones. Opciones disponibles: 1 2 3 4 5 6 -c <DIR> configuration directory -d dump configuration. For debugging -i interactive mode -v increase verbosity -q decrease verbosity -x force execution of the server Comandos b\u00e1sicos: 1 2 3 4 5 reload reloads the configuration reload <JAIL> reloads the jail <JAIL> stop stops all jails and terminate the server status gets the current status of the server ping tests if the server is alive Comandos de log: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 set loglevel <LEVEL> sets logging level to <LEVEL>. Levels: CRITICAL, ERROR, WARNING, NOTICE, INFO, DEBUG get loglevel gets the logging level set logtarget <TARGET> sets logging target to <TARGET>. Can be STDOUT, STDERR, SYSLOG or a file get logtarget gets logging target set syslogsocket auto | <SOCKET> sets the syslog socket path to auto or <SOCKET>. Only used if logtarget is SYSLOG get syslogsocket gets syslog socket path flushlogs flushes the logtarget if a file and reopens it. For log rotation. Comandos de la base de datos: 1 2 3 4 5 6 7 8 9 10 11 12 set dbfile <FILE> set the location of fail2ban persistent datastore. Set to \"None\" to disable get dbfile get the location of fail2ban persistent datastore set dbpurgeage <SECONDS> sets the max age in <SECONDS> that history of bans will be kept get dbpurgeage gets the max age in seconds that history of bans will be kept Adem\u00e1s tiene una bastante cantidad de comandos que act\u00faan sobre la configuraci\u00f3n de los JAILS en el que veremos alg\u00fan ejemplo m\u00e1s adelante. fail2ban-regex \u00b6 Se usa para realizar tests con expresiones regulares espec\u00edficas o personalizadas. fail2ban-testcases \u00b6 Se usa para realizar un test general. Ejemplo de funcionamiento \u00b6 Vamos a comprobar si funciona el jail por defecto que es \"sshd\". Miramos los jails activados con: 1 fail2ban-client status Nos responde: 1 2 3 Status | - Number of jail: 1 ` - Jail list: sshd Podemos ver los estados de ese jail en concreto: 1 fail2ban-client status sshd Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: sshd | - Filter | | - Currently failed: 0 | | - Total failed: 0 | ` - File list: /var/log/auth.log ` - Actions | - Currently banned: 0 | - Total banned: 0 ` - Banned IP list: Ahora procedemos a forzar intentos fallidos de autenticaci\u00f3n mediante ssh hacia la m\u00e1quina desde mi m\u00e1quina anfitri\u00f3n: 1 ssh vagrant@192.168.1.27 1 2 3 4 5 6 7 8 9 10 11 pedro@jpdeb1:~$ ssh vagrant@192.168.1.27 vagrant@192.168.1.27 's password: Permission denied, please try again. vagrant@192.168.1.27' s password: Permission denied, please try again. vagrant@192.168.1.27 's password: Permission denied (publickey,password). pedro@jpdeb1:~$ ssh vagrant@192.168.1.27 vagrant@192.168.1.27' s password: Permission denied, please try again. vagrant@192.168.1.27 ' s password: En el sexto intento se queda la petici\u00f3n en el aire sin devolvernos error ni nada ya que el m\u00e1ximo de intentos configurados por defecto es de \"5\" en el fichero /etc/fail2ban/jail.conf en la opci\u00f3n maxretry = . Y este es el estado del jail : 1 fail2ban-client status sshd 1 2 3 4 5 6 7 8 9 Status for the jail: sshd | - Filter | | - Currently failed: 1 | | - Total failed: 6 | ` - File list: /var/log/auth.log ` - Actions | - Currently banned: 1 | - Total banned: 1 ` - Banned IP list: 192 .168.1.4 Regla de \"iptables\" creada: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 root@jpfail:~# iptables -L Chain INPUT ( policy ACCEPT ) target prot opt source destination f2b-sshd tcp -- anywhere anywhere multiport dports ssh Chain FORWARD ( policy ACCEPT ) target prot opt source destination Chain OUTPUT ( policy ACCEPT ) target prot opt source destination Chain f2b-sshd ( 1 references ) target prot opt source destination REJECT all -- 192 .168.1.4 anywhere reject-with icmp-port-unreachable RETURN all -- anywhere anywhere Por defecto esa ip estar\u00e1 \"baneada\" durante \"600\" segundos configurados en el fichero /etc/fail2ban/jail.conf en la opci\u00f3n bantime = . Viendo la configuraci\u00f3n del jail \"sshd\" \u00b6 Fichero /etc/fail2ban/jail.conf : \u00b6 1 2 3 4 5 [ sshd ] port = ssh logpath = % ( sshd_log ) s backend = % ( sshd_backend ) s Aqu\u00ed se define lo siguiente: Nombre del JAIL: sshd Puerto = ssh Path del log: %(sshd_log)s Que esto remite al fichero /etc/fail2ban/paths-common.conf donde: 1 sshd_log = % ( syslog_authpriv ) s Y donde finalmente el fichero del log del JAIL \"sshd\" es: 1 syslog_authpriv = /var/log/auth.log Definido en el fichero /etc/fail2ban/paths-debian.conf Fichero /etc/fail2ban/filter.d/sshd.conf : \u00b6 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 [ Definition ] _daemon = sshd failregex = ^% ( __prefix_line ) s ( ?:error: PAM: ) ? [ aA ] uthentication ( ?:failure | error | failed ) for .* from <HOST> ( via \\S + ) ? \\s *$ ^% ( __prefix_line ) s ( ?:error: PAM: ) ?User not known to the underlying authentication module for .* from <HOST> \\s *$ ^% ( __prefix_line ) sFailed \\S + for ( ?P<cond_inv>invalid user ) ? ( ?P<user> ( ?P<cond_user> \\S + ) | ( ? ( cond_inv )( ?: ( ?! from ) . ) *? | [ ^: ] + )) from <HOST> ( ?: port \\d + ) ? ( ?: ssh \\d * ) ? ( ? ( cond_user ) : | ( ?: ( ?: ( ?! from ) . ) * ) $ ) ^% ( __prefix_line ) sROOT LOGIN REFUSED.* FROM <HOST> \\s *$ ^% ( __prefix_line ) s [ iI ]( ?:llegal | nvalid ) user .*? from <HOST> ( ?: port \\d + ) ? \\s *$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because not listed in AllowUsers \\s *$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because listed in DenyUsers \\s *$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because not in any group \\s *$ ^% ( __prefix_line ) srefused connect from \\S + \\( <HOST> \\)\\s *$ ^% ( __prefix_line ) s ( ?:error: ) ?Received disconnect from <HOST>: 3 : .*: Auth fail ( ?: \\[ preauth \\] ) ?$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because a group is listed in DenyGroups \\s *$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because none of user ' s groups are listed in AllowGroups \\s *$ ^ ( ?P<__prefix>% ( __prefix_line ) s ) User .+ not allowed because account is locked<SKIPLINES> ( ?P = __prefix )( ?:error: ) ?Received disconnect from <HOST>: 11 : .+ \\[ preauth \\] $ ^ ( ?P<__prefix>% ( __prefix_line ) s ) Disconnecting: Too many authentication failures for .+? \\[ preauth \\] <SKIPLINES> ( ?P = __prefix )( ?:error: ) ?Connection closed by <HOST> \\[ preauth \\] $ ^ ( ?P<__prefix>% ( __prefix_line ) s ) Connection from <HOST> port \\d + ( ?: on \\S + port \\d + ) ?<SKIPLINES> ( ?P = __prefix ) Disconnecting: Too many authentication failures for .+? \\[ preauth \\] $ ^% ( __prefix_line ) s ( error: ) ?maximum authentication attempts exceeded for .* from <HOST> ( ?: port \\d * ) ? ( ?: ssh \\d * ) ? \\[ preauth \\] $ ^% ( __prefix_line ) spam_unix \\( sshd:auth \\) : \\s +authentication failure ; \\s *logname = \\S * \\s *uid = \\d * \\s *euid = \\d * \\s *tty = \\S * \\s *ruser = \\S * \\s *rhost = <HOST> \\s .*$ ignoreregex = [ Init ] # \"maxlines\" is number of log lines to buffer for multi-line regex searches maxlines = 10 journalmatch = _SYSTEMD_UNIT = sshd.service + _COMM = sshd Aqu\u00ed vemos una gran cantidad de expresiones regulares usadas, adem\u00e1s en la opci\u00f3n _daemon se especifica el nombre del JAIL. Actions en SSHD \u00b6 Las acciones a relizar son las definidas por defecto en el fichero /etc/fail2ban/jail.conf : 1 2 3 banaction = iptables-multiport action_ = % ( banaction ) s [ name = % ( __name__ ) s, bantime = \"%(bantime)s\" , port = \"%(port)s\" , protocol = \"%(protocol)s\" , chain = \"%(chain)s\" ] Que ser\u00e1 la action definida en el fichero /etc/fail2ban/action.d/iptables-multiport.conf . Enviar Correos \u00b6 Lo primero ser\u00e1 instalar un servidor de correo, en nuestro caso usaremos postfix: 1 apt install postfix En las ventanas interactivas elegimos: Local Only fail2ban.org Tambien instalamos el cliente de correo que usa fail2ban por defecto: 1 apt install bsd-mailx Le vamos a a\u00f1adir la action para enviar correos editando el fichero /etc/fail2ban/jail.d/defaults-debian.conf : 1 2 3 4 [ sshd ] enabled = true mta = mail action = % ( action_mw ) s Recargamos la configruaci\u00f3n: 1 fail2ban-client reload Con esto si se crea alg\u00fan \"baneo\" se enviar\u00e1 un correo al usuario local root por defecto adem\u00e1s se env\u00eda un correo cada vez se inicia o para el JAIL. Configuraci\u00f3n para Apache2 y mysql(mariadb) \u00b6 Apache2 \u00b6 El uso que le daremos a esta herramienta con Apcahe2 ser\u00e1 activar el JAIL apache-auth el cual detectar\u00e1 los intentos fallidos de autenticaci\u00f3n en sitios web. Configuraci\u00f3n de prueba de Apache2 \u00b6 Creamos el directorio de la web: 1 mkdir -p /var/www/fail2ban Creamos el fichero index.html de la web: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 echo ''' <!DOCTYPE HTML> <html lang=\"es\"> <head> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /> <title>Prueba Fail2Ban</title> </head> <body> <h1>Prueba autenticaci\u00f3n fallida con Fail2ban</h1> </body> </html> ''' >> /var/www/fail2ban/index.html Damos permisos a www-data : 1 chown -R www-data:www-data /var/www Creamos el sitio en Apache2: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 echo ''' <VirtualHost *:80> ServerName www.fail2ban.org ServerAdmin webmaster@localhost DocumentRoot /var/www/fail2ban <Directory /var/www/fail2ban/> AuthType basic AuthName \"PRIVADO\" AuthUserFile /etc/apache2/password Require valid-user </Directory> ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined </VirtualHost> # vim: syntax=apache ts=4 sw=4 sts=4 sr noet ''' > /etc/apache2/sites-available/fail2ban.conf Activamos el sitio: 1 a2ensite fail2ban.conf Y recargamos la configuraci\u00f3n de Apache2: 1 systemctl reload apache2 Para acceder a esta p\u00e1gina desde nuestra m\u00e1quina anfitri\u00f3n debemos configurar el /etc/hosts de esta. Iniciaci\u00f3n de JAIL apache-auth \u00b6 Lo primero ser\u00e1 a\u00f1adir en el fichero /etc/fail2ban/jail.d/defaults-debian.conf lo siguiente: 1 2 [ apache-auth ] enabled = true Podemos hacerlo con: 1 2 3 4 5 6 echo ''' [apache-auth] enabled = true ''' >> /etc/fail2ban/jail.d/defaults-debian.conf Ahora recargamos la configuraci\u00f3n con: 1 fail2ban-client reload Ya podremos trabajar con este JAIL activado. Prueba de JAIL apache-auth \u00b6 Comprobamos que est\u00e1 activado con: 1 fail2ban-client status Nos responde: 1 2 3 Status | - Number of jail: 2 ` - Jail list: apache-auth, sshd Vemos el estado del JAIL apache-auth : 1 fail2ban-client status apache-auth Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: apache-auth | - Filter | | - Currently failed: 0 | | - Total failed: 0 | ` - File list: /var/log/apache2/error.log ` - Actions | - Currently banned: 0 | - Total banned: 0 ` - Banned IP list: Tambi\u00e9n podemos ver m\u00e1s f\u00e1cilmente la configuraci\u00f3n de los JAIL mediante los comandos de Fail2Ban: 1 2 3 4 5 6 7 8 9 root@jpfail:~# fail2ban-client get apache-auth action bantime ignorecommand logencoding usedns actionmethods datepattern ignoreip logpath actionproperties failregex ignoreregex maxlines actions findtime journalmatch maxretry root@jpfail:~# fail2ban-client get apache-auth actions The jail apache-auth has the following actions: iptables-multiport root@jpfail:~# Ahora realizamos varios intentos fallidos de autenticaci\u00f3n en el sitio web y vemos el estado del JAIL: 1 fail2ban-client status apache-auth Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: apache-auth | - Filter | | - Currently failed: 0 | | - Total failed: 5 | ` - File list: /var/log/apache2/error.log ` - Actions | - Currently banned: 1 | - Total banned: 1 ` - Banned IP list: 192 .168.1.4 Para eliminar este JAIL podemos hacerlo de 2 maneras: Editando el fichero /etc/fail2ban/jail.d/defaults-debian.conf , eliminando las l\u00edneas de este JAIL en concreto y haciendo un \"reload\". O con el comando: 1 fail2ban-client stop apache-auth mysql(mariadb) \u00b6 El uso que le daremos a esta herramienta con mysql ser\u00e1 activar el JAIL mysql-auth el cual detectar\u00e1 los intentos fallidos de autenticaci\u00f3n en las bases de datos del sistema. Configuraci\u00f3n de prueba de mysql \u00b6 Entramos en Mariadb como ROOT: 1 mariadb -u root Creamos un usuario: 1 2 CREATE USER 'fail2ban' @ '192.168.1.4' IDENTIFIED BY 'fail2ban' ; EXIT ; Configuramos mariadb para que podamos acceder desde una red cualquiera: 1 2 3 nano /etc/mysql/mariadb.conf.d/50-server.cnf bind-address = 0 .0.0.0 Configuramos mariadb para que guarde los logs mas severos en su fichero log de error: 1 2 3 echo \"log-warnings=2\" >> /etc/mysql/mariadb.conf.d/50-server.cnf systemctl restart mysqld Iniciaci\u00f3n de JAIL mysqld-auth \u00b6 A\u00f1adimos en el fichero /etc/fail2ban/jail.d/defaults-debian.conf lo siguiente: 1 2 3 4 5 6 echo ''' [mysqld-auth] enabled = true ''' >> /etc/fail2ban/jail.d/defaults-debian.conf Recargamos la configuraci\u00f3n: 1 fail2ban-client reload Este JAIL necesita un poco de configuraci\u00f3n extra. Tendremos que cambiar el logpath . Eliminamos el actual con: 1 fail2ban-client set mysqld-auth dellogpath /var/log/daemon.log Y a\u00f1adimos el nuevo: 1 fail2ban-client set mysqld-auth addlogpath /var/log/mysql/error.log Prueba de JAIL mysqld-auth \u00b6 Comprobamos que est\u00e1 activado con: 1 fail2ban-client status Nos responde: 1 2 3 Status | - Number of jail: 2 ` - Jail list: mysqld-auth, sshd Vemos el estado del JAIL mysqld-auth : 1 2 3 4 5 6 7 8 9 Status for the jail: mysqld-auth | - Filter | | - Currently failed: 0 | | - Total failed: 0 | ` - File list: /var/log/mysql/error.log ` - Actions | - Currently banned: 0 | - Total banned: 0 ` - Banned IP list: Ahora realizamos varios intentos fallidos de autenticaci\u00f3n en la base de datos: 1 mariadb -u fail2ban -h 192 .168.1.27 -p 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 pedro@jpdeb1:~/$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 1045 ( 28000 ) : Access denied for user 'fail2ban' @ '192.168.1.4' ( using password: NO ) pedro@jpdeb1:~$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 1045 ( 28000 ) : Access denied for user 'fail2ban' @ '192.168.1.4' ( using password: NO ) pedro@jpdeb1:~$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 1045 ( 28000 ) : Access denied for user 'fail2ban' @ '192.168.1.4' ( using password: NO ) pedro@jpdeb1:~$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 1045 ( 28000 ) : Access denied for user 'fail2ban' @ '192.168.1.4' ( using password: NO ) pedro@jpdeb1:~$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 2003 ( HY000 ) : Can 't connect to MySQL server on ' 192 .168.1.27 ' ( 111 \"Connection refused\" ) Al final me deniega el acceso aunque ponga bien la contrase\u00f1a. Vemos el estado del JAIL: 1 fail2ban-client status mysqld-auth Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: mysqld-auth | - Filter | | - Currently failed: 0 | | - Total failed: 5 | ` - File list: /var/log/mysql/error.log ` - Actions | - Currently banned: 1 | - Total banned: 1 ` - Banned IP list: 192 .168.1.4 Si queremos \"desbanear\" la ip podemos usar lo siguiente: 1 fail2ban-client set mysqld-auth unbanip 192 .168.1.4 Vemos el estado del JAIL: 1 fail2ban-client status mysqld-auth Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: mysqld-auth | - Filter | | - Currently failed: 0 | | - Total failed: 5 | ` - File list: /var/log/mysql/error.log ` - Actions | - Currently banned: 0 | - Total banned: 1 ` - Banned IP list: Con esto terminamos este sencillo tutorial de esta herramienta tan simple pero a la vez tan funcional. Enlaces de Inter\u00e9s para este Post \u00b6 Fail2Ban 10 IDS MARIADB Configuration","title":"Fail2Ban"},{"location":"blog/fail2ban/#instalacion-y-uso-de-herramienta-de-seguridad-fail2ban-en-debian-stretch-95","text":"Vamos a ver esta vez una buena herramienta que funcionar\u00e1 como Sistema de Detecci\u00f3n de Intrusos (IDS o HIDS). Fail2ban nos permite ver los accesos o intentos de accesos en el sistema o en servicios del sistema y adem\u00e1s podremos aplicar medidas. Funciona leyendo ficheros de logs y aplicando reglas de iptables generalmente.","title":"Instalaci\u00f3n y uso de herramienta de seguridad Fail2Ban en Debian Stretch 9.5"},{"location":"blog/fail2ban/#caracteristicas-fail2ban","text":"Est\u00e1 desarrollado en Python3 y tiene las siguientes funcionalidades: Cliente/Servidor. Multiprocesamiento. Autodetecci\u00f3n del formato de la fecha. Soporte para bastantes servicios como ssh o apache. Soporte para realizar acciones como iptables o env\u00edo de correos. Compatible con SystemD y SystemV. Usa una base de datos SQLite3 para guardar los baneos.","title":"Caracter\u00edsticas Fail2Ban"},{"location":"blog/fail2ban/#definiciones","text":"Fail2Ban usa filter Son las expresiones regulares utilizadas para el \"parseo\" de los logs. action Son las acciones a realizar seg\u00fan los acontecimientos encontrados en los logs. jail Son un conjunto de filter y action utilizados independientemente por cada servicio denominado. Puede ser por ejemplo \"ssh\" o \"apache2\" o incluso variaciones de estas ya incluidas. Podemos crear filter , action y jail personalizados que veamos oportunos para nuestro sistema customizado.","title":"Definiciones"},{"location":"blog/fail2ban/#configuracion-inicial-de-la-maquina","text":"","title":"Configuraci\u00f3n inicial de la m\u00e1quina"},{"location":"blog/fail2ban/#maquina-virtual-con-vagrant-y-virtualbox","text":"Fichero Vagrantfile: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant . configure ( \"2\" ) do | config | config . vm . define \"nodo1\" do | nodo1 | config . vm . provider \"virtualbox\" do | vb | vb . name = \"jpfail\" end nodo1 . vm . box = \"debian/stretch64\" nodo1 . vm . hostname = \"jpfail\" nodo1 . vm . network \"public_network\" , bridge : \"wlan0\" , use_dhcp_assigned_default_route : true end end","title":"M\u00e1quina virtual con Vagrant y VirtualBox:"},{"location":"blog/fail2ban/#arrancamos-maquina","text":"1 vagrant up","title":"Arrancamos m\u00e1quina:"},{"location":"blog/fail2ban/#accedemos-mediante-ssh","text":"1 vagrant ssh","title":"Accedemos mediante SSH:"},{"location":"blog/fail2ban/#instalacion","text":"","title":"Instalaci\u00f3n"},{"location":"blog/fail2ban/#actualizacion-del-sistema","text":"1 2 sudo su - apt update && apt -y upgrade","title":"Actualizaci\u00f3n del sistema:"},{"location":"blog/fail2ban/#requerimientos","text":"Actualmente la \u00faltima versi\u00f3n de Fail2ban es la 0.9.6 . Esta versi\u00f3n requiere uno de los siguientes paquetes: Python 2.6 o superior. Python 3.2 o superior. PyPy.","title":"Requerimientos:"},{"location":"blog/fail2ban/#instalamos-fail2ban","text":"1 apt -y install fail2ban","title":"Instalamos Fail2Ban:"},{"location":"blog/fail2ban/#ficheros-de-configuracion","text":"Los ficheros de configuraci\u00f3n de Fail2Ban se encuentran en /etc/fail2ban . Tambi\u00e9n existe uno en /etc/default/fail2ban que configura el usuario que usar\u00e1 Fail2Ban que por defecto es \"root\" adem\u00e1s se podr\u00e1 configurar con opciones del arranque de esta herramienta.","title":"Ficheros de configuraci\u00f3n"},{"location":"blog/fail2ban/#generales","text":"","title":"Generales"},{"location":"blog/fail2ban/#etcfail2banfail2banconf","text":"Es la configuraci\u00f3n principal de Fail2Ban y en el se encuentra lo siguiente: 1 2 3 4 5 6 7 8 9 10 11 12 13 loglevel = INFO logtarget = /var/log/fail2ban.log syslogsocket = auto socket = /var/run/fail2ban/fail2ban.sock pidfile = /var/run/fail2ban/fail2ban.pid dbfile = /var/lib/fail2ban/fail2ban.sqlite3 dbpurgeage = 86400 Tambi\u00e9n podremos modificar estas configuraciones con el comando fail2ban-client que veremos m\u00e1s adelante.","title":"/etc/fail2ban/fail2ban.conf"},{"location":"blog/fail2ban/#etcfail2banpaths-42conf","text":"Es la declaraci\u00f3n de los directorios de los logs principales usados con esta herramienta.","title":"/etc/fail2ban/paths-*.conf"},{"location":"blog/fail2ban/#filters","text":"","title":"FILTERS"},{"location":"blog/fail2ban/#etcfail2banfilterd42conf","text":"Aqu\u00ed se encuentran las configuraciones de las expresiones regulares utilizadas para el parseo de logs en cada servicio o jail . Un ejemplo ser\u00eda por ejemplo el el fichero apache-common.conf : 1 2 3 [ DEFAULT ] _apache_error_client = \\[\\] \\[ ( :?error | \\S +: \\S + ) \\] ( \\[ pid \\d + ( : \\S + \\d + ) ? \\] ) ? \\[ client <HOST> ( : \\d { 1 ,5 }) ? \\] En el se ve la expresi\u00f3n regular que busca si ha habido alg\u00fan error con un cliente.","title":"/etc/fail2ban/filter.d/*.conf"},{"location":"blog/fail2ban/#actions","text":"","title":"ACTIONS"},{"location":"blog/fail2ban/#etcfail2banactiond42conf","text":"Aqu\u00ed se encuentran las configuraciones de las acciones principales a realizar en caso de estar configurado en un servicio o jail . Un ejemplo ser\u00eda por ejemplo el el fichero iptables.conf : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 [ INCLUDES ] before = iptables-common.conf [ Definition ] actionstart = <iptables> -N f2b-<name> <iptables> -A f2b-<name> -j <returntype> <iptables> -I <chain> -p <protocol> --dport <port> -j f2b-<name> actionstop = <iptables> -D <chain> -p <protocol> --dport <port> -j f2b-<name> <iptables> -F f2b-<name> <iptables> -X f2b-<name> actioncheck = <iptables> -n -L <chain> | grep -q 'f2b-<name>[ \\t]' actionban = <iptables> -I f2b-<name> 1 -s <ip> -j <blocktype> actionunban = <iptables> -D f2b-<name> -s <ip> -j <blocktype> [ Init ] En este fichero se encuentran las acciones definidas a relizar si se usa esta action como comprobar las reglas \"iptables\", a\u00f1adir una regla, eliminarla, etc...","title":"/etc/fail2ban/action.d/*.conf"},{"location":"blog/fail2ban/#jails","text":"","title":"JAILS"},{"location":"blog/fail2ban/#etcfail2banjailconf","text":"Es la configuraci\u00f3n principal de los JAILS . Aqu\u00ed se encuentran las configuraciones de todos los jails que se pueden usar pero que no estan activados por defecto y no se recomienda modificar. Un ejemplo son las configuraciones por defecto: 1 2 3 4 5 6 7 8 9 [ DEFAULT ] ignoreip = 127 .0.0.1/8 bantime = 600 findtime = 600 maxretry = 5 M\u00e1s abajo se definen las configuraciones de algunas actions y todos los jails que se pueden usar por defecto.","title":"/etc/fail2ban/jail.conf"},{"location":"blog/fail2ban/#etcfail2banjaild42conf","text":"Existe un solo fichero que es /etc/fail2ban/jail.d/defaults-debian.conf . En el se configurar\u00e1 la activaci\u00f3n de los jails por defecto. 1 2 [ sshd ] enabled = true Por defecto solo est\u00e1 activado el jail de ssh.","title":"/etc/fail2ban/jail.d/*.conf"},{"location":"blog/fail2ban/#scripts-o-comandos-de-fail2ban","text":"","title":"Scripts o comandos de Fail2Ban"},{"location":"blog/fail2ban/#fail2ban-server","text":"Este arranca en segundo plano autom\u00e1ticamente al instalarse Fail2Ban y es el proceso principal. Opciones disponibles: 1 2 3 4 5 -b start in background -f start in foreground -s <FILE> socket path -p <FILE> pidfile path -x force execution of the server","title":"fail2ban-server"},{"location":"blog/fail2ban/#fail2ban-client","text":"Es el \"frontend\" y el que se comunica con el servidor envi\u00e1ndole \u00f3rdenes y configuraciones. Opciones disponibles: 1 2 3 4 5 6 -c <DIR> configuration directory -d dump configuration. For debugging -i interactive mode -v increase verbosity -q decrease verbosity -x force execution of the server Comandos b\u00e1sicos: 1 2 3 4 5 reload reloads the configuration reload <JAIL> reloads the jail <JAIL> stop stops all jails and terminate the server status gets the current status of the server ping tests if the server is alive Comandos de log: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 set loglevel <LEVEL> sets logging level to <LEVEL>. Levels: CRITICAL, ERROR, WARNING, NOTICE, INFO, DEBUG get loglevel gets the logging level set logtarget <TARGET> sets logging target to <TARGET>. Can be STDOUT, STDERR, SYSLOG or a file get logtarget gets logging target set syslogsocket auto | <SOCKET> sets the syslog socket path to auto or <SOCKET>. Only used if logtarget is SYSLOG get syslogsocket gets syslog socket path flushlogs flushes the logtarget if a file and reopens it. For log rotation. Comandos de la base de datos: 1 2 3 4 5 6 7 8 9 10 11 12 set dbfile <FILE> set the location of fail2ban persistent datastore. Set to \"None\" to disable get dbfile get the location of fail2ban persistent datastore set dbpurgeage <SECONDS> sets the max age in <SECONDS> that history of bans will be kept get dbpurgeage gets the max age in seconds that history of bans will be kept Adem\u00e1s tiene una bastante cantidad de comandos que act\u00faan sobre la configuraci\u00f3n de los JAILS en el que veremos alg\u00fan ejemplo m\u00e1s adelante.","title":"fail2ban-client"},{"location":"blog/fail2ban/#fail2ban-regex","text":"Se usa para realizar tests con expresiones regulares espec\u00edficas o personalizadas.","title":"fail2ban-regex"},{"location":"blog/fail2ban/#fail2ban-testcases","text":"Se usa para realizar un test general.","title":"fail2ban-testcases"},{"location":"blog/fail2ban/#ejemplo-de-funcionamiento","text":"Vamos a comprobar si funciona el jail por defecto que es \"sshd\". Miramos los jails activados con: 1 fail2ban-client status Nos responde: 1 2 3 Status | - Number of jail: 1 ` - Jail list: sshd Podemos ver los estados de ese jail en concreto: 1 fail2ban-client status sshd Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: sshd | - Filter | | - Currently failed: 0 | | - Total failed: 0 | ` - File list: /var/log/auth.log ` - Actions | - Currently banned: 0 | - Total banned: 0 ` - Banned IP list: Ahora procedemos a forzar intentos fallidos de autenticaci\u00f3n mediante ssh hacia la m\u00e1quina desde mi m\u00e1quina anfitri\u00f3n: 1 ssh vagrant@192.168.1.27 1 2 3 4 5 6 7 8 9 10 11 pedro@jpdeb1:~$ ssh vagrant@192.168.1.27 vagrant@192.168.1.27 's password: Permission denied, please try again. vagrant@192.168.1.27' s password: Permission denied, please try again. vagrant@192.168.1.27 's password: Permission denied (publickey,password). pedro@jpdeb1:~$ ssh vagrant@192.168.1.27 vagrant@192.168.1.27' s password: Permission denied, please try again. vagrant@192.168.1.27 ' s password: En el sexto intento se queda la petici\u00f3n en el aire sin devolvernos error ni nada ya que el m\u00e1ximo de intentos configurados por defecto es de \"5\" en el fichero /etc/fail2ban/jail.conf en la opci\u00f3n maxretry = . Y este es el estado del jail : 1 fail2ban-client status sshd 1 2 3 4 5 6 7 8 9 Status for the jail: sshd | - Filter | | - Currently failed: 1 | | - Total failed: 6 | ` - File list: /var/log/auth.log ` - Actions | - Currently banned: 1 | - Total banned: 1 ` - Banned IP list: 192 .168.1.4 Regla de \"iptables\" creada: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 root@jpfail:~# iptables -L Chain INPUT ( policy ACCEPT ) target prot opt source destination f2b-sshd tcp -- anywhere anywhere multiport dports ssh Chain FORWARD ( policy ACCEPT ) target prot opt source destination Chain OUTPUT ( policy ACCEPT ) target prot opt source destination Chain f2b-sshd ( 1 references ) target prot opt source destination REJECT all -- 192 .168.1.4 anywhere reject-with icmp-port-unreachable RETURN all -- anywhere anywhere Por defecto esa ip estar\u00e1 \"baneada\" durante \"600\" segundos configurados en el fichero /etc/fail2ban/jail.conf en la opci\u00f3n bantime = .","title":"Ejemplo de funcionamiento"},{"location":"blog/fail2ban/#viendo-la-configuracion-del-jail-sshd","text":"","title":"Viendo la configuraci\u00f3n del jail \"sshd\""},{"location":"blog/fail2ban/#fichero-etcfail2banjailconf","text":"1 2 3 4 5 [ sshd ] port = ssh logpath = % ( sshd_log ) s backend = % ( sshd_backend ) s Aqu\u00ed se define lo siguiente: Nombre del JAIL: sshd Puerto = ssh Path del log: %(sshd_log)s Que esto remite al fichero /etc/fail2ban/paths-common.conf donde: 1 sshd_log = % ( syslog_authpriv ) s Y donde finalmente el fichero del log del JAIL \"sshd\" es: 1 syslog_authpriv = /var/log/auth.log Definido en el fichero /etc/fail2ban/paths-debian.conf","title":"Fichero /etc/fail2ban/jail.conf:"},{"location":"blog/fail2ban/#fichero-etcfail2banfilterdsshdconf","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 [ Definition ] _daemon = sshd failregex = ^% ( __prefix_line ) s ( ?:error: PAM: ) ? [ aA ] uthentication ( ?:failure | error | failed ) for .* from <HOST> ( via \\S + ) ? \\s *$ ^% ( __prefix_line ) s ( ?:error: PAM: ) ?User not known to the underlying authentication module for .* from <HOST> \\s *$ ^% ( __prefix_line ) sFailed \\S + for ( ?P<cond_inv>invalid user ) ? ( ?P<user> ( ?P<cond_user> \\S + ) | ( ? ( cond_inv )( ?: ( ?! from ) . ) *? | [ ^: ] + )) from <HOST> ( ?: port \\d + ) ? ( ?: ssh \\d * ) ? ( ? ( cond_user ) : | ( ?: ( ?: ( ?! from ) . ) * ) $ ) ^% ( __prefix_line ) sROOT LOGIN REFUSED.* FROM <HOST> \\s *$ ^% ( __prefix_line ) s [ iI ]( ?:llegal | nvalid ) user .*? from <HOST> ( ?: port \\d + ) ? \\s *$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because not listed in AllowUsers \\s *$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because listed in DenyUsers \\s *$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because not in any group \\s *$ ^% ( __prefix_line ) srefused connect from \\S + \\( <HOST> \\)\\s *$ ^% ( __prefix_line ) s ( ?:error: ) ?Received disconnect from <HOST>: 3 : .*: Auth fail ( ?: \\[ preauth \\] ) ?$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because a group is listed in DenyGroups \\s *$ ^% ( __prefix_line ) sUser .+ from <HOST> not allowed because none of user ' s groups are listed in AllowGroups \\s *$ ^ ( ?P<__prefix>% ( __prefix_line ) s ) User .+ not allowed because account is locked<SKIPLINES> ( ?P = __prefix )( ?:error: ) ?Received disconnect from <HOST>: 11 : .+ \\[ preauth \\] $ ^ ( ?P<__prefix>% ( __prefix_line ) s ) Disconnecting: Too many authentication failures for .+? \\[ preauth \\] <SKIPLINES> ( ?P = __prefix )( ?:error: ) ?Connection closed by <HOST> \\[ preauth \\] $ ^ ( ?P<__prefix>% ( __prefix_line ) s ) Connection from <HOST> port \\d + ( ?: on \\S + port \\d + ) ?<SKIPLINES> ( ?P = __prefix ) Disconnecting: Too many authentication failures for .+? \\[ preauth \\] $ ^% ( __prefix_line ) s ( error: ) ?maximum authentication attempts exceeded for .* from <HOST> ( ?: port \\d * ) ? ( ?: ssh \\d * ) ? \\[ preauth \\] $ ^% ( __prefix_line ) spam_unix \\( sshd:auth \\) : \\s +authentication failure ; \\s *logname = \\S * \\s *uid = \\d * \\s *euid = \\d * \\s *tty = \\S * \\s *ruser = \\S * \\s *rhost = <HOST> \\s .*$ ignoreregex = [ Init ] # \"maxlines\" is number of log lines to buffer for multi-line regex searches maxlines = 10 journalmatch = _SYSTEMD_UNIT = sshd.service + _COMM = sshd Aqu\u00ed vemos una gran cantidad de expresiones regulares usadas, adem\u00e1s en la opci\u00f3n _daemon se especifica el nombre del JAIL.","title":"Fichero /etc/fail2ban/filter.d/sshd.conf:"},{"location":"blog/fail2ban/#actions-en-sshd","text":"Las acciones a relizar son las definidas por defecto en el fichero /etc/fail2ban/jail.conf : 1 2 3 banaction = iptables-multiport action_ = % ( banaction ) s [ name = % ( __name__ ) s, bantime = \"%(bantime)s\" , port = \"%(port)s\" , protocol = \"%(protocol)s\" , chain = \"%(chain)s\" ] Que ser\u00e1 la action definida en el fichero /etc/fail2ban/action.d/iptables-multiport.conf .","title":"Actions en SSHD"},{"location":"blog/fail2ban/#enviar-correos","text":"Lo primero ser\u00e1 instalar un servidor de correo, en nuestro caso usaremos postfix: 1 apt install postfix En las ventanas interactivas elegimos: Local Only fail2ban.org Tambien instalamos el cliente de correo que usa fail2ban por defecto: 1 apt install bsd-mailx Le vamos a a\u00f1adir la action para enviar correos editando el fichero /etc/fail2ban/jail.d/defaults-debian.conf : 1 2 3 4 [ sshd ] enabled = true mta = mail action = % ( action_mw ) s Recargamos la configruaci\u00f3n: 1 fail2ban-client reload Con esto si se crea alg\u00fan \"baneo\" se enviar\u00e1 un correo al usuario local root por defecto adem\u00e1s se env\u00eda un correo cada vez se inicia o para el JAIL.","title":"Enviar Correos"},{"location":"blog/fail2ban/#configuracion-para-apache2-y-mysqlmariadb","text":"","title":"Configuraci\u00f3n para Apache2 y mysql(mariadb)"},{"location":"blog/fail2ban/#apache2","text":"El uso que le daremos a esta herramienta con Apcahe2 ser\u00e1 activar el JAIL apache-auth el cual detectar\u00e1 los intentos fallidos de autenticaci\u00f3n en sitios web.","title":"Apache2"},{"location":"blog/fail2ban/#configuracion-de-prueba-de-apache2","text":"Creamos el directorio de la web: 1 mkdir -p /var/www/fail2ban Creamos el fichero index.html de la web: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 echo ''' <!DOCTYPE HTML> <html lang=\"es\"> <head> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /> <title>Prueba Fail2Ban</title> </head> <body> <h1>Prueba autenticaci\u00f3n fallida con Fail2ban</h1> </body> </html> ''' >> /var/www/fail2ban/index.html Damos permisos a www-data : 1 chown -R www-data:www-data /var/www Creamos el sitio en Apache2: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 echo ''' <VirtualHost *:80> ServerName www.fail2ban.org ServerAdmin webmaster@localhost DocumentRoot /var/www/fail2ban <Directory /var/www/fail2ban/> AuthType basic AuthName \"PRIVADO\" AuthUserFile /etc/apache2/password Require valid-user </Directory> ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined </VirtualHost> # vim: syntax=apache ts=4 sw=4 sts=4 sr noet ''' > /etc/apache2/sites-available/fail2ban.conf Activamos el sitio: 1 a2ensite fail2ban.conf Y recargamos la configuraci\u00f3n de Apache2: 1 systemctl reload apache2 Para acceder a esta p\u00e1gina desde nuestra m\u00e1quina anfitri\u00f3n debemos configurar el /etc/hosts de esta.","title":"Configuraci\u00f3n de prueba de Apache2"},{"location":"blog/fail2ban/#iniciacion-de-jail-apache-auth","text":"Lo primero ser\u00e1 a\u00f1adir en el fichero /etc/fail2ban/jail.d/defaults-debian.conf lo siguiente: 1 2 [ apache-auth ] enabled = true Podemos hacerlo con: 1 2 3 4 5 6 echo ''' [apache-auth] enabled = true ''' >> /etc/fail2ban/jail.d/defaults-debian.conf Ahora recargamos la configuraci\u00f3n con: 1 fail2ban-client reload Ya podremos trabajar con este JAIL activado.","title":"Iniciaci\u00f3n de JAIL apache-auth"},{"location":"blog/fail2ban/#prueba-de-jail-apache-auth","text":"Comprobamos que est\u00e1 activado con: 1 fail2ban-client status Nos responde: 1 2 3 Status | - Number of jail: 2 ` - Jail list: apache-auth, sshd Vemos el estado del JAIL apache-auth : 1 fail2ban-client status apache-auth Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: apache-auth | - Filter | | - Currently failed: 0 | | - Total failed: 0 | ` - File list: /var/log/apache2/error.log ` - Actions | - Currently banned: 0 | - Total banned: 0 ` - Banned IP list: Tambi\u00e9n podemos ver m\u00e1s f\u00e1cilmente la configuraci\u00f3n de los JAIL mediante los comandos de Fail2Ban: 1 2 3 4 5 6 7 8 9 root@jpfail:~# fail2ban-client get apache-auth action bantime ignorecommand logencoding usedns actionmethods datepattern ignoreip logpath actionproperties failregex ignoreregex maxlines actions findtime journalmatch maxretry root@jpfail:~# fail2ban-client get apache-auth actions The jail apache-auth has the following actions: iptables-multiport root@jpfail:~# Ahora realizamos varios intentos fallidos de autenticaci\u00f3n en el sitio web y vemos el estado del JAIL: 1 fail2ban-client status apache-auth Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: apache-auth | - Filter | | - Currently failed: 0 | | - Total failed: 5 | ` - File list: /var/log/apache2/error.log ` - Actions | - Currently banned: 1 | - Total banned: 1 ` - Banned IP list: 192 .168.1.4 Para eliminar este JAIL podemos hacerlo de 2 maneras: Editando el fichero /etc/fail2ban/jail.d/defaults-debian.conf , eliminando las l\u00edneas de este JAIL en concreto y haciendo un \"reload\". O con el comando: 1 fail2ban-client stop apache-auth","title":"Prueba de JAIL apache-auth"},{"location":"blog/fail2ban/#mysqlmariadb","text":"El uso que le daremos a esta herramienta con mysql ser\u00e1 activar el JAIL mysql-auth el cual detectar\u00e1 los intentos fallidos de autenticaci\u00f3n en las bases de datos del sistema.","title":"mysql(mariadb)"},{"location":"blog/fail2ban/#configuracion-de-prueba-de-mysql","text":"Entramos en Mariadb como ROOT: 1 mariadb -u root Creamos un usuario: 1 2 CREATE USER 'fail2ban' @ '192.168.1.4' IDENTIFIED BY 'fail2ban' ; EXIT ; Configuramos mariadb para que podamos acceder desde una red cualquiera: 1 2 3 nano /etc/mysql/mariadb.conf.d/50-server.cnf bind-address = 0 .0.0.0 Configuramos mariadb para que guarde los logs mas severos en su fichero log de error: 1 2 3 echo \"log-warnings=2\" >> /etc/mysql/mariadb.conf.d/50-server.cnf systemctl restart mysqld","title":"Configuraci\u00f3n de prueba de mysql"},{"location":"blog/fail2ban/#iniciacion-de-jail-mysqld-auth","text":"A\u00f1adimos en el fichero /etc/fail2ban/jail.d/defaults-debian.conf lo siguiente: 1 2 3 4 5 6 echo ''' [mysqld-auth] enabled = true ''' >> /etc/fail2ban/jail.d/defaults-debian.conf Recargamos la configuraci\u00f3n: 1 fail2ban-client reload Este JAIL necesita un poco de configuraci\u00f3n extra. Tendremos que cambiar el logpath . Eliminamos el actual con: 1 fail2ban-client set mysqld-auth dellogpath /var/log/daemon.log Y a\u00f1adimos el nuevo: 1 fail2ban-client set mysqld-auth addlogpath /var/log/mysql/error.log","title":"Iniciaci\u00f3n de JAIL mysqld-auth"},{"location":"blog/fail2ban/#prueba-de-jail-mysqld-auth","text":"Comprobamos que est\u00e1 activado con: 1 fail2ban-client status Nos responde: 1 2 3 Status | - Number of jail: 2 ` - Jail list: mysqld-auth, sshd Vemos el estado del JAIL mysqld-auth : 1 2 3 4 5 6 7 8 9 Status for the jail: mysqld-auth | - Filter | | - Currently failed: 0 | | - Total failed: 0 | ` - File list: /var/log/mysql/error.log ` - Actions | - Currently banned: 0 | - Total banned: 0 ` - Banned IP list: Ahora realizamos varios intentos fallidos de autenticaci\u00f3n en la base de datos: 1 mariadb -u fail2ban -h 192 .168.1.27 -p 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 pedro@jpdeb1:~/$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 1045 ( 28000 ) : Access denied for user 'fail2ban' @ '192.168.1.4' ( using password: NO ) pedro@jpdeb1:~$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 1045 ( 28000 ) : Access denied for user 'fail2ban' @ '192.168.1.4' ( using password: NO ) pedro@jpdeb1:~$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 1045 ( 28000 ) : Access denied for user 'fail2ban' @ '192.168.1.4' ( using password: NO ) pedro@jpdeb1:~$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 1045 ( 28000 ) : Access denied for user 'fail2ban' @ '192.168.1.4' ( using password: NO ) pedro@jpdeb1:~$ mariadb -u fail2ban -h 192 .168.1.27 -p Enter password: ERROR 2003 ( HY000 ) : Can 't connect to MySQL server on ' 192 .168.1.27 ' ( 111 \"Connection refused\" ) Al final me deniega el acceso aunque ponga bien la contrase\u00f1a. Vemos el estado del JAIL: 1 fail2ban-client status mysqld-auth Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: mysqld-auth | - Filter | | - Currently failed: 0 | | - Total failed: 5 | ` - File list: /var/log/mysql/error.log ` - Actions | - Currently banned: 1 | - Total banned: 1 ` - Banned IP list: 192 .168.1.4 Si queremos \"desbanear\" la ip podemos usar lo siguiente: 1 fail2ban-client set mysqld-auth unbanip 192 .168.1.4 Vemos el estado del JAIL: 1 fail2ban-client status mysqld-auth Nos responde: 1 2 3 4 5 6 7 8 9 Status for the jail: mysqld-auth | - Filter | | - Currently failed: 0 | | - Total failed: 5 | ` - File list: /var/log/mysql/error.log ` - Actions | - Currently banned: 0 | - Total banned: 1 ` - Banned IP list: Con esto terminamos este sencillo tutorial de esta herramienta tan simple pero a la vez tan funcional.","title":"Prueba de JAIL mysqld-auth"},{"location":"blog/fail2ban/#enlaces-de-interes-para-este-post","text":"Fail2Ban 10 IDS MARIADB Configuration","title":"Enlaces de Inter\u00e9s para este Post"},{"location":"blog/kernel/","text":"Kernel Linux \u00b6 En este post veremos como configurar el kernel linux y adaptarlo a las necesidades m\u00ednimas de nuestra m\u00e1quina. Instalaci\u00f3n \u00b6 Antes de instalar algo en Entornos Debian: 1 2 sudo apt update sudo apt upgrade Instalamos el paquete del kernel: 1 sudo apt-get install linux-source-4.9 Nos crear\u00e1 un fichero en /usr/src/linux-source-4.9.tar.bz2 Instalamos las bibliotecas de desarrollo para configurar el kernel eligiendo la que mas nos guste: menuconfig 1 sudo apt-get install libncurses5-dev gconfig: 1 sudo apt-get install libgtk2.0-dev libglib2.0-dev libglade2-dev xconfig 1 sudo apt-get install libqt4-dev Utilizamos un directorio donde trabajar: 1 2 3 4 mkdir ~/kernel cd ~/kernel cp /usr/src/linux-source-4.9.tar.xz ./ tar -xJf linux-source-4.9.tar.xz Utilizamos el fichero de configuraci\u00f3n de m\u00f3dulos del kernel actual: 1 cp /boot/config- ` uname -r ` ~/kernel/linux-source-4.9/.config Etiquetamos la versi\u00f3n del kernel que vamos a crear: 1 nano ~/kernel/linux-source-4.9/Makefile Editamos la l\u00ednea EXTRAVERSION : 1 2 3 4 5 VERSION = 4 PATCHLEVEL = 9 SUBLEVEL = 110 EXTRAVERSION = -1 NAME = Roaring Lionus Creamos una nueva configuraci\u00f3n del kernel adaptada a nuestra m\u00e1quina con: 1 2 cd ~/kernel/linux-source-4.9/ make localmodconfig Con esto nos habr\u00e1 configurado el fichero ~/kernel/linux-source-4.9/.config autom\u00e1ticamente. Ahora podemos usar una de las herramientas de configuraci\u00f3n del kernel estando en el directorio ~/kernel/linux-source-4.9/ : 1 make menuconfig 1 make gconfig 1 make xconfig Yo usar\u00e9 xconfig : Marcamos las casillas de los m\u00f3dulos que necesitamos y guardamos.Ahora se ha modificado otra vez el fichero ~/kernel/linux-source-4.9/.config . Con esto ya compilamos: 1 make deb-pkg Podemos usar la herramienta time para ver cuanto tarda: 1 time make deb-pkg Por defecto el compilador solo usa un core a la vez, si queremos usar mas de uno utilizamos el siguiente par\u00e1metro: 1 time make -j 4 deb-pkg Nos crear\u00e1 varios ficheros en el directorio padre: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 juanpe@jpdeb2:~/kernel/linux-source-4.9$ ls -l .. total 342500 drwxr-xr-x 2 juanpe juanpe 21 oct 1 09 :37 configs -rw-r--r-- 1 juanpe juanpe 2878 oct 2 09 :21 linux-4.9.110-1_4.9.110-1-1_amd64.changes -rw-r--r-- 1 juanpe juanpe 1353 oct 2 09 :21 linux-4.9.110-1_4.9.110-1-1.debian.tar.gz -rw-r--r-- 1 juanpe juanpe 1134 oct 2 09 :21 linux-4.9.110-1_4.9.110-1-1.dsc -rw-r--r-- 1 juanpe juanpe 141384410 oct 2 08 :50 linux-4.9.110-1_4.9.110-1.orig.tar.gz -rw-r--r-- 1 juanpe juanpe 10382700 oct 2 09 :18 linux-headers-4.9.110-1_4.9.110-1-1_amd64.deb -rw-r--r-- 1 juanpe juanpe 7783044 oct 2 09 :18 linux-image-4.9.110-1_4.9.110-1-1_amd64.deb -rw-r--r-- 1 juanpe juanpe 95573034 oct 2 09 :21 linux-image-4.9.110-1-dbg_4.9.110-1-1_amd64.deb -rw-r--r-- 1 juanpe juanpe 869814 oct 2 09 :18 linux-libc-dev_4.9.110-1-1_amd64.deb drwxr-xr-x 25 juanpe juanpe 4096 oct 2 09 :21 linux-source-4.9 -rw-r--r-- 1 juanpe juanpe 94699084 oct 1 08 :27 linux-source-4.9.tar.xz juanpe@jpdeb2:~/kernel/linux-source-4.9$ Procedemos a instalar con dpkg el paquete linux-image-4.9.110-1_4.9.110-1-1_amd64.deb : 1 sudo dpkg -i ../linux-image-4.9.110-1_4.9.110-1-1_amd64.deb Y reiniciamos: 1 sudo reboot","title":"Kernel Linux"},{"location":"blog/kernel/#kernel-linux","text":"En este post veremos como configurar el kernel linux y adaptarlo a las necesidades m\u00ednimas de nuestra m\u00e1quina.","title":"Kernel Linux"},{"location":"blog/kernel/#instalacion","text":"Antes de instalar algo en Entornos Debian: 1 2 sudo apt update sudo apt upgrade Instalamos el paquete del kernel: 1 sudo apt-get install linux-source-4.9 Nos crear\u00e1 un fichero en /usr/src/linux-source-4.9.tar.bz2 Instalamos las bibliotecas de desarrollo para configurar el kernel eligiendo la que mas nos guste: menuconfig 1 sudo apt-get install libncurses5-dev gconfig: 1 sudo apt-get install libgtk2.0-dev libglib2.0-dev libglade2-dev xconfig 1 sudo apt-get install libqt4-dev Utilizamos un directorio donde trabajar: 1 2 3 4 mkdir ~/kernel cd ~/kernel cp /usr/src/linux-source-4.9.tar.xz ./ tar -xJf linux-source-4.9.tar.xz Utilizamos el fichero de configuraci\u00f3n de m\u00f3dulos del kernel actual: 1 cp /boot/config- ` uname -r ` ~/kernel/linux-source-4.9/.config Etiquetamos la versi\u00f3n del kernel que vamos a crear: 1 nano ~/kernel/linux-source-4.9/Makefile Editamos la l\u00ednea EXTRAVERSION : 1 2 3 4 5 VERSION = 4 PATCHLEVEL = 9 SUBLEVEL = 110 EXTRAVERSION = -1 NAME = Roaring Lionus Creamos una nueva configuraci\u00f3n del kernel adaptada a nuestra m\u00e1quina con: 1 2 cd ~/kernel/linux-source-4.9/ make localmodconfig Con esto nos habr\u00e1 configurado el fichero ~/kernel/linux-source-4.9/.config autom\u00e1ticamente. Ahora podemos usar una de las herramientas de configuraci\u00f3n del kernel estando en el directorio ~/kernel/linux-source-4.9/ : 1 make menuconfig 1 make gconfig 1 make xconfig Yo usar\u00e9 xconfig : Marcamos las casillas de los m\u00f3dulos que necesitamos y guardamos.Ahora se ha modificado otra vez el fichero ~/kernel/linux-source-4.9/.config . Con esto ya compilamos: 1 make deb-pkg Podemos usar la herramienta time para ver cuanto tarda: 1 time make deb-pkg Por defecto el compilador solo usa un core a la vez, si queremos usar mas de uno utilizamos el siguiente par\u00e1metro: 1 time make -j 4 deb-pkg Nos crear\u00e1 varios ficheros en el directorio padre: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 juanpe@jpdeb2:~/kernel/linux-source-4.9$ ls -l .. total 342500 drwxr-xr-x 2 juanpe juanpe 21 oct 1 09 :37 configs -rw-r--r-- 1 juanpe juanpe 2878 oct 2 09 :21 linux-4.9.110-1_4.9.110-1-1_amd64.changes -rw-r--r-- 1 juanpe juanpe 1353 oct 2 09 :21 linux-4.9.110-1_4.9.110-1-1.debian.tar.gz -rw-r--r-- 1 juanpe juanpe 1134 oct 2 09 :21 linux-4.9.110-1_4.9.110-1-1.dsc -rw-r--r-- 1 juanpe juanpe 141384410 oct 2 08 :50 linux-4.9.110-1_4.9.110-1.orig.tar.gz -rw-r--r-- 1 juanpe juanpe 10382700 oct 2 09 :18 linux-headers-4.9.110-1_4.9.110-1-1_amd64.deb -rw-r--r-- 1 juanpe juanpe 7783044 oct 2 09 :18 linux-image-4.9.110-1_4.9.110-1-1_amd64.deb -rw-r--r-- 1 juanpe juanpe 95573034 oct 2 09 :21 linux-image-4.9.110-1-dbg_4.9.110-1-1_amd64.deb -rw-r--r-- 1 juanpe juanpe 869814 oct 2 09 :18 linux-libc-dev_4.9.110-1-1_amd64.deb drwxr-xr-x 25 juanpe juanpe 4096 oct 2 09 :21 linux-source-4.9 -rw-r--r-- 1 juanpe juanpe 94699084 oct 1 08 :27 linux-source-4.9.tar.xz juanpe@jpdeb2:~/kernel/linux-source-4.9$ Procedemos a instalar con dpkg el paquete linux-image-4.9.110-1_4.9.110-1-1_amd64.deb : 1 sudo dpkg -i ../linux-image-4.9.110-1_4.9.110-1-1_amd64.deb Y reiniciamos: 1 sudo reboot","title":"Instalaci\u00f3n"},{"location":"blog/mkdocs/","text":"MkDocs \u00b6 En este post veremos como crear p\u00e1ginas est\u00e1ticas con MkDocs en un entorno Debian Stretch y luego desplegarlas con GitHubPages . Instalaci\u00f3n \u00b6 Antes de instalar algo en Entornos Debian: 1 sudo apt update Instalamos Python y Pip ya que MkDocs est\u00e1 desarrollado en Python: 1 2 sudo apt-get install python3.5 sudo apt-get install python3-pip Instalamos el creador de entornos virtuales de Python para instalar los modulos necesarios en nuestro entorno: 1 sudo apt-get install python3-venv Creamos el entorno: 1 python3 -m venv mkdocs_env Activamos el entorno: 1 source mkdocs_env/bin/activate Instalamos el generador de p\u00e1ginas est\u00e1ticas MkDocs: 1 pip install mkdocs Instalamos tambi\u00e9n una plantilla para nuestro sitio: 1 pip install mkdocs-material Creaci\u00f3n del sitio \u00b6 Para empezar generamos un sitio est\u00e1ndar: 1 2 mkdocs new sitio1 cd sitio1 La configuraci\u00f3n se realiza en el fihero Para m\u00e1s documentaci\u00f3n visita: mkdocs.org pages.github.com De esta forma podr\u00edas insertar una imagen O dos, sin ensuciar tu espacio de escritura.","title":"MkDocs"},{"location":"blog/mkdocs/#mkdocs","text":"En este post veremos como crear p\u00e1ginas est\u00e1ticas con MkDocs en un entorno Debian Stretch y luego desplegarlas con GitHubPages .","title":"MkDocs"},{"location":"blog/mkdocs/#instalacion","text":"Antes de instalar algo en Entornos Debian: 1 sudo apt update Instalamos Python y Pip ya que MkDocs est\u00e1 desarrollado en Python: 1 2 sudo apt-get install python3.5 sudo apt-get install python3-pip Instalamos el creador de entornos virtuales de Python para instalar los modulos necesarios en nuestro entorno: 1 sudo apt-get install python3-venv Creamos el entorno: 1 python3 -m venv mkdocs_env Activamos el entorno: 1 source mkdocs_env/bin/activate Instalamos el generador de p\u00e1ginas est\u00e1ticas MkDocs: 1 pip install mkdocs Instalamos tambi\u00e9n una plantilla para nuestro sitio: 1 pip install mkdocs-material","title":"Instalaci\u00f3n"},{"location":"blog/mkdocs/#creacion-del-sitio","text":"Para empezar generamos un sitio est\u00e1ndar: 1 2 mkdocs new sitio1 cd sitio1 La configuraci\u00f3n se realiza en el fihero Para m\u00e1s documentaci\u00f3n visita: mkdocs.org pages.github.com De esta forma podr\u00edas insertar una imagen O dos, sin ensuciar tu espacio de escritura.","title":"Creaci\u00f3n del sitio"},{"location":"blog/oracleinstall/","text":"Instalaci\u00f3n Oracle Database 12c versi\u00f3n 2(12.1.0) Enterprise Edition en Debian Jessie 8.11 \u00b6 Y aqu\u00ed llega lo que no suele ser visto con Oracle, la instalaci\u00f3n de su software privativo de base de datos en un sistema que no est\u00e1 soportado, en un sistema Debian. As\u00ed es, aqu\u00ed descubrimeros que entresijos tiene realizar una instalaci\u00f3n b\u00e1sica en varios pasos. Configuraci\u00f3n inicial de la m\u00e1quina \u00b6 El espacio temporal: debe ser mayor que 500 MB. (Espacio en /tmp) El espacio de intercambio: debe ser mayor que 150 MB. (SWAP) El monitor: debe estar configurado para mostrar al menos 256 colores. (Tener instalado \"xorg\") Instalaci\u00f3n de debian en VirtualBox con: 30GB de disco duro 2GB de RAM 2 procesadores virtuales ISO imagen debian-8.11.0-amd64-netinst.iso Debian Conexi\u00f3n a Internet Instalaci\u00f3n de paquetes con debian-installer: Utilidades est\u00e1ndar del sistema SSH server Reposistorios recomendados para debian: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 su - echo \"\"\" ############################ Debian Main Repos ############################ deb http://deb.debian.org/debian/ oldstable main contrib non-free deb-src http://deb.debian.org/debian/ oldstable main contrib non-free deb http://deb.debian.org/debian/ oldstable-updates main contrib non-free deb-src http://deb.debian.org/debian/ oldstable-updates main contrib non-free deb http://deb.debian.org/debian-security oldstable/updates main deb-src http://deb.debian.org/debian-security oldstable/updates main deb http://ftp.debian.org/debian jessie-backports main deb-src http://ftp.debian.org/debian jessie-backports main ########################################################################## \"\"\" > /etc/apt/sources.list Actualizamos la lista de paquetes y el sistema: 1 apt update && apt -y upgrade Configuraci\u00f3n inicial personalizada para Oracle \u00b6 Se suele sugerir la siguiente estructura de grupos y usuarios: 1 2 3 4 5 addgroup --system oinstall addgroup --system dba adduser --system --ingroup oinstall -shell /bin/bash oracle adduser oracle dba passwd oracle Creaci\u00f3n de directorios requeridos por Oracle: 1 2 3 mkdir -p /opt/oracle/product/12.1.0.2 mkdir -p /opt/oraInventory chown -R oracle:dba /opt/ora* Para instalar oracle se necesitan crear los siguientes enlaces: 1 2 3 4 ln -s /usr/bin/awk /bin/awk ln -s /usr/bin/basename /bin/basename ln -s /usr/bin/rpm /bin/rpm ln -s /usr/lib/x86_64-linux-gnu /usr/lib64 L\u00edmites en el sistema (por seguridad): 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 echo \"\"\" ## Valor del n\u00famero m\u00e1ximo de manejadores de archivos. ## fs.file-max = 65536 fs.aio-max-nr = 1048576 ## Valor de los par\u00e1metros de sem\u00e1foro en el orden listado. ## ## semmsl, semmns, semopm, semmni ## kernel.sem = 250 32000 100 128 ## Valor de los tama\u00f1os de segmento de memoria compartida. ## ## (Oracle recomienda total de RAM -1 byte) 2GB ## kernel.shmmax = 2147483648 kernel.shmall = 2097152 kernel.shmmni = 4096 ## Valor del rango de n\u00fameros de puerto. ## net.ipv4.ip_local_port_range = 1024 65000 ## Valor del n\u00famero gid del grupo dba. ## vm.hugetlb_shm_group = 114 ## Valor del n\u00famero de p\u00e1ginas de memoria. ## vm.nr_hugepages = 64 \"\"\" > /etc/sysctl.d/local-oracle.conf Atenci\u00f3n Importante que vm.hugetlb_shm_group sea el GID del grupo dba . bash cat /etc/group | grep dba Cargamos la configuraci\u00f3n al sistema: 1 sysctl -p /etc/sysctl.d/local-oracle.conf Tambi\u00e9n creamos esta configuraci\u00f3n por seguridad: 1 2 3 4 5 6 7 8 9 10 11 echo \"\"\" ## N\u00famero m\u00e1ximo de procesos disponibles para un solo usuario. ## oracle soft nproc 2047 oracle hard nproc 16384 ## N\u00famero m\u00e1ximo de descriptores de archivo abiertos para un solo usuario. ## oracle soft nofile 1024 oracle hard nofile 65536 ## Cantidad de RAM para el uso de p\u00e1ginas de memoria. ## oracle soft memlock 204800 oracle hard memlock 204800 \"\"\" > /etc/security/limits.d/local-oracle.conf Variables de entorno para Oracle: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 echo \"\"\" ## Nombre del equipo ## export ORACLE_HOSTNAME=localhost ## Usuario con permiso en archivos Oracle. ## export ORACLE_OWNER=oracle ## Directorio que almacenar\u00e1 los distintos servicios de Oracle. ## export ORACLE_BASE=/opt/oracle ## Directorio que almacenar\u00e1 la base de datos Oracle. ## export ORACLE_HOME=/opt/oracle/product/12.1.0.2/dbhome_1 ## Nombre \u00fanico de la base de datos. ## export ORACLE_UNQNAME=orcl ## Identificador de servicio de escucha. ## export ORACLE_SID=orcl ## Ruta a archivos binarios. ## export PATH= $PATH :/opt/oracle/product/12.1.0.2/dbhome_1/bin ## Ruta a la biblioteca. ## export LD_LIBRARY_PATH= $LD_LIBRARY_PATH :/usr/lib/x86_64-linux-gnu:/bin/lib:/lib/x86_64-linux-gnu/:/usr/lib64 \"\"\" >> /etc/bash.bashrc Cargamos las variables de entorno: 1 source /etc/bash.bashrc Atenci\u00f3n Importante establecer correctamente las variables de entorno. Instalaci\u00f3n de paquetes necesarios: 1 apt install build-essential binutils libcap-dev gcc g++ libc6-dev ksh libaio-dev make libxi-dev libxtst-dev libxau-dev libxcb1-dev sysstat rpm xauth xorg unzip Descargas de Oracle Database Software \u00b6 Esta acci\u00f3n la realizaremos en el equipo anfitri\u00f3n con entorno gr\u00e1fico. Link para descarga: Oracle Primero iniciamos sesi\u00f3n y aceptamos el \"License Agreement\". Luego elegimos el siguiente: Oracle Database 12c Release 1 (12.1.0.2.0) Enterprise Edition linux x86-64 File 1 (3.2 GB) Descomprimimos el zip: Abrimos consola y nos situamos en el directorio de la descarga: 1 2 cd Descargas unzip linuxx64_12102_database.zip Pasamos lo descomprimido a la m\u00e1quina virtual: Aparecer\u00e1 una carpeta database , esa carpeta la copiaremos mediante scp a la m\u00e1quina virtual: 1 scp -r database/ oracle@192.168.1.25: Instalaci\u00f3n de Oracle \u00b6 Ejecutaremos mediante ssh y X11forward el instalador de Oracle con entorno gr\u00e1fico: 1 2 ssh -XC oracle@192.168.1.25 database/runInstaller -IgnoreSysPreReqs La opci\u00f3n -IgnoreSysPreReqs es para que ignorar los prerequisitos del sistema. La opci\u00f3n -X ejecuta aplicaciones gr\u00e1ficas. La opci\u00f3n -C es para comprimir los datos de la conexi\u00f3n. Configurar Actualizaciones de Seguridad Demarcamos la casilla para recibir actualizaciones y continuamos con Siguiente > . Nos aparecer\u00e1 una ventana para decirnos que Oracle no est\u00e1 soportado para este sistema y que el instalador no realizar\u00e1 las comprobaciones de requisitos en el sistema, la ignoramos y continuamos diciendo S\u00ed . Seleccionar Opci\u00f3n de Instalaci\u00f3n Elegimos la opci\u00f3n para \"Crear y configurar base de datos\" ya que vamos a crear una nueva base de datos y continuamos con Siguiente > . Clase de Sistema Elegimos la opci\u00f3n \"Clase de Servidor\" y continuamos con Siguiente > . Opciones de Instalci\u00f3n de Grid Elegimos \"Instalaci\u00f3n de Base de Datos de Instancia \u00danica\" y continuamos con Siguiente > . Tipo de Instalaci\u00f3n Elegimos Avanzada para configurar mas a fondo. Idiomas Dejamos por defecto. Edici\u00f3n de Base de Datos Solo nos deja Enterprise Edition. Ubicaci\u00f3n de Instalaci\u00f3n Si tenemos bien definidas las variavles de entorno se configura autom\u00e1ticamente. Crear Inventario Si tenemos bien definidas las variavles de entorno se configura autom\u00e1ticamente. Tipo de COnfiguraci\u00f3n Para Uso General. Especificar Identificadores de Base de Datos Dejamos valores por defecto. Opciones de Configuraci\u00f3n En \"Juego de Caracteres\" elegimos \"Unicode\". Y en \"Esquemas de Ejemplo\" marcamos la casilla para crear la base de datos con esquemas de ejemplo. Almacenamiento en la base de datos Dejamos por defecto. Opciones de Gesti\u00f3n Saltamos este paso y continuamos con Siguiente > . Opciones de Recuperaci\u00f3n Saltamos este paso y continuamos con Siguiente > . Contrase\u00f1as de Esquemas Para mayor comodidad usamos la misma contrase\u00f1a para todas las cuentas. Adem\u00e1s Oracle recomienda una contrase\u00f1a de al menos 8 caracteres, al menos una en may\u00fascula, otra en min\u00fascula y al menos un car\u00e1cter alfanum\u00e9rico. Grupos del Sistema Operativo con privilegios Dejamos por defecto. Resumen de Instalaci\u00f3n Aqu\u00ed vemos la configuraci\u00f3n final de la instalaci\u00f3n para poder comprobar si tenemos alg\u00fan error. Seleccionamos \"Instalar\". Instalar Producto Este paso tardar\u00e1 algunos minutos. Ejecutar Scripts de Configuraci\u00f3n Finalizando la instalaci\u00f3n Oracle nos pide que ejecutemos unos scripts como ROOT: 1 2 /opt/oraInventory/orainstRoot.sh /opt/oracle/product/12.2.0/dbhome_1/root.sh Asistente de Configuraci\u00f3n de base de Datos Al finalizar la ejecuci\u00f3n de los scripts pulsamos Aceptar y comenzar\u00e1 el proceso de creaci\u00f3n de la base de datos que tardar\u00e1 a\u00fan mas tiempo que la instalaci\u00f3n del software. As\u00ed que a esperar... Fin Configuraci\u00f3n Pasados bastantes minutos Oracle nos muestra alguna informaci\u00f3n de la base de datos como la URL de \"Enterprise Manager Database Express\" en: 1 https://localhost:5500/em Para acceder a dicha aplicaci\u00f3n web necesitaremos tener instalado Adobe Flash Player y aceptar la excepci\u00f3n de seguridad de esa p\u00e1gina. Los accesos desde otras redes est\u00e1n abiertas por defecto. https://192.168.1.25:5500/em Aceptamos. Fin de la instalaci\u00f3n Accediendo a la base de datos \u00b6 El acceso a la base de datos lo realizaremos mediante l\u00ednea de comandos con \"sqlplus\". Podemos instalar un paquete que nos ayudar\u00e1 con un uso mas amigable de \"sqlplus\": 1 apt install rlwrap Accedemos a la base de datos: 1 rlwrap sqlplus sys/PASS as sysdba Ejecutamos consulta para ver la versi\u00f3n de Oracle: 1 select * from v$version ; Para poder crear usuarios ejecutamos lo siguiente: alter session set \"_ORACLE_SCRIPT\"=true; -\\ \\ \\ \\ \\ \\ -\u00d3 echo 'alter session set \"_ORACLE_SCRIPT\"=true;' >> $ORACLE_HOME/sqlplus/admin/glogin.sql Iniciaci\u00f3n de la base de datos \u00b6 Por defecto si reinicio la m\u00e1quina no arranca oracle asi que de momento la arrancaremos manualmente: Estado del Listener 1 lsnrctl status Arrancamos el Listener: 1 lsnrctl start Arrancamos la base de datos: 1 sqlplus / as sysdba 1 startup Configuraci\u00f3n acceso remoto Oracle \u00b6 Si necesitamos acceder mediante la red seguiremos los siguientes pasos: Editamos la configuraci\u00f3n del \"Listener\" de oracle en $ORACLE_HOME/network/admin/listener.ora : 1 nano $ORACLE_HOME /network/admin/listener.ora Dejamos el fichero tal que as\u00ed para que puedan acceder desde cualquier red: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 SID_LIST_LISTENER = ( SID_LIST = ( SID_DESC = ( GLOBAL_DBNAME = orcl ) ( ORACLE_HOME = /opt/oracle/product/12.1.0.2/dbhome_1 ) ( SID_NAME = orcl ) ) ) LISTENER = ( DESCRIPTION_LIST = ( DESCRIPTION = ( ADDRESS_LIST = ( ADDRESS = ( PROTOCOL = IPC )( KEY = EXTPROC1521 )) ) ( ADDRESS_LIST = ( ADDRESS = ( PROTOCOL = TCP )( HOST = 0 .0.0.0 )( PORT = 1521 )) ) ) ) Reiniciamos el \"Listener\" con: 1 2 lsnrctl stop lsnrctl start Instalaci\u00f3n de Cliente SQLPlus remoto \u00b6 Lo primero ser\u00e1 instalar alien el cual nos permite reempaquetar un fichero .rpm en .deb : 1 apt install alien Luego nos descargamos los ficheros RPM necesarios de la p\u00e1gina de Oracle Aceptamos los t\u00e9rminos y elegimos los siguientes paquetes: -- Version 12.1.0.2.0 -- oracle-instantclient12.1-basic-12.1.0.2.0-1.x86_64.rpm oracle-instantclient12.1-sqlplus-12.1.0.2.0-1.x86_64.rpm oracle-instantclient12.1-devel-12.1.0.2.0-1.x86_64.rpm Reempaquetamos: 1 alien --to-deb --scripts oracle-instantclient12.1-*.rpm Instalamos los paquetes generados: 1 dpkg -i oracle-instantclient12.1-*.rpm A\u00f1adimos la variabe de entorno necesaria: 1 2 3 echo ''' export LD_LIBRARY_PATH=/usr/lib/oracle/12.1/client64/lib/:$LD_LIBRARY_PATH ''' >> /etc/bash.bashrc Ya podemos usar SQLPlus remotamente: 1 sqlplus64 system/PASS@//192.168.1.25:1521/orcl Y con esto y un bizcocho se acab\u00f3 Oracle!! De momento... Enlaces de Inter\u00e9s \u00b6 Oracle Oficial Wiki Debian debian-administration oracle-base dbaora gemsofprogramming Oracle Oficial 10g Blog juanjo Blog Aitor","title":"Install Oracle 12"},{"location":"blog/oracleinstall/#instalacion-oracle-database-12c-version-21210-enterprise-edition-en-debian-jessie-811","text":"Y aqu\u00ed llega lo que no suele ser visto con Oracle, la instalaci\u00f3n de su software privativo de base de datos en un sistema que no est\u00e1 soportado, en un sistema Debian. As\u00ed es, aqu\u00ed descubrimeros que entresijos tiene realizar una instalaci\u00f3n b\u00e1sica en varios pasos.","title":"Instalaci\u00f3n Oracle Database 12c versi\u00f3n 2(12.1.0) Enterprise Edition en Debian Jessie 8.11"},{"location":"blog/oracleinstall/#configuracion-inicial-de-la-maquina","text":"El espacio temporal: debe ser mayor que 500 MB. (Espacio en /tmp) El espacio de intercambio: debe ser mayor que 150 MB. (SWAP) El monitor: debe estar configurado para mostrar al menos 256 colores. (Tener instalado \"xorg\") Instalaci\u00f3n de debian en VirtualBox con: 30GB de disco duro 2GB de RAM 2 procesadores virtuales ISO imagen debian-8.11.0-amd64-netinst.iso Debian Conexi\u00f3n a Internet Instalaci\u00f3n de paquetes con debian-installer: Utilidades est\u00e1ndar del sistema SSH server Reposistorios recomendados para debian: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 su - echo \"\"\" ############################ Debian Main Repos ############################ deb http://deb.debian.org/debian/ oldstable main contrib non-free deb-src http://deb.debian.org/debian/ oldstable main contrib non-free deb http://deb.debian.org/debian/ oldstable-updates main contrib non-free deb-src http://deb.debian.org/debian/ oldstable-updates main contrib non-free deb http://deb.debian.org/debian-security oldstable/updates main deb-src http://deb.debian.org/debian-security oldstable/updates main deb http://ftp.debian.org/debian jessie-backports main deb-src http://ftp.debian.org/debian jessie-backports main ########################################################################## \"\"\" > /etc/apt/sources.list Actualizamos la lista de paquetes y el sistema: 1 apt update && apt -y upgrade","title":"Configuraci\u00f3n inicial de la m\u00e1quina"},{"location":"blog/oracleinstall/#configuracion-inicial-personalizada-para-oracle","text":"Se suele sugerir la siguiente estructura de grupos y usuarios: 1 2 3 4 5 addgroup --system oinstall addgroup --system dba adduser --system --ingroup oinstall -shell /bin/bash oracle adduser oracle dba passwd oracle Creaci\u00f3n de directorios requeridos por Oracle: 1 2 3 mkdir -p /opt/oracle/product/12.1.0.2 mkdir -p /opt/oraInventory chown -R oracle:dba /opt/ora* Para instalar oracle se necesitan crear los siguientes enlaces: 1 2 3 4 ln -s /usr/bin/awk /bin/awk ln -s /usr/bin/basename /bin/basename ln -s /usr/bin/rpm /bin/rpm ln -s /usr/lib/x86_64-linux-gnu /usr/lib64 L\u00edmites en el sistema (por seguridad): 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 echo \"\"\" ## Valor del n\u00famero m\u00e1ximo de manejadores de archivos. ## fs.file-max = 65536 fs.aio-max-nr = 1048576 ## Valor de los par\u00e1metros de sem\u00e1foro en el orden listado. ## ## semmsl, semmns, semopm, semmni ## kernel.sem = 250 32000 100 128 ## Valor de los tama\u00f1os de segmento de memoria compartida. ## ## (Oracle recomienda total de RAM -1 byte) 2GB ## kernel.shmmax = 2147483648 kernel.shmall = 2097152 kernel.shmmni = 4096 ## Valor del rango de n\u00fameros de puerto. ## net.ipv4.ip_local_port_range = 1024 65000 ## Valor del n\u00famero gid del grupo dba. ## vm.hugetlb_shm_group = 114 ## Valor del n\u00famero de p\u00e1ginas de memoria. ## vm.nr_hugepages = 64 \"\"\" > /etc/sysctl.d/local-oracle.conf Atenci\u00f3n Importante que vm.hugetlb_shm_group sea el GID del grupo dba . bash cat /etc/group | grep dba Cargamos la configuraci\u00f3n al sistema: 1 sysctl -p /etc/sysctl.d/local-oracle.conf Tambi\u00e9n creamos esta configuraci\u00f3n por seguridad: 1 2 3 4 5 6 7 8 9 10 11 echo \"\"\" ## N\u00famero m\u00e1ximo de procesos disponibles para un solo usuario. ## oracle soft nproc 2047 oracle hard nproc 16384 ## N\u00famero m\u00e1ximo de descriptores de archivo abiertos para un solo usuario. ## oracle soft nofile 1024 oracle hard nofile 65536 ## Cantidad de RAM para el uso de p\u00e1ginas de memoria. ## oracle soft memlock 204800 oracle hard memlock 204800 \"\"\" > /etc/security/limits.d/local-oracle.conf Variables de entorno para Oracle: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 echo \"\"\" ## Nombre del equipo ## export ORACLE_HOSTNAME=localhost ## Usuario con permiso en archivos Oracle. ## export ORACLE_OWNER=oracle ## Directorio que almacenar\u00e1 los distintos servicios de Oracle. ## export ORACLE_BASE=/opt/oracle ## Directorio que almacenar\u00e1 la base de datos Oracle. ## export ORACLE_HOME=/opt/oracle/product/12.1.0.2/dbhome_1 ## Nombre \u00fanico de la base de datos. ## export ORACLE_UNQNAME=orcl ## Identificador de servicio de escucha. ## export ORACLE_SID=orcl ## Ruta a archivos binarios. ## export PATH= $PATH :/opt/oracle/product/12.1.0.2/dbhome_1/bin ## Ruta a la biblioteca. ## export LD_LIBRARY_PATH= $LD_LIBRARY_PATH :/usr/lib/x86_64-linux-gnu:/bin/lib:/lib/x86_64-linux-gnu/:/usr/lib64 \"\"\" >> /etc/bash.bashrc Cargamos las variables de entorno: 1 source /etc/bash.bashrc Atenci\u00f3n Importante establecer correctamente las variables de entorno. Instalaci\u00f3n de paquetes necesarios: 1 apt install build-essential binutils libcap-dev gcc g++ libc6-dev ksh libaio-dev make libxi-dev libxtst-dev libxau-dev libxcb1-dev sysstat rpm xauth xorg unzip","title":"Configuraci\u00f3n inicial personalizada para Oracle"},{"location":"blog/oracleinstall/#descargas-de-oracle-database-software","text":"Esta acci\u00f3n la realizaremos en el equipo anfitri\u00f3n con entorno gr\u00e1fico. Link para descarga: Oracle Primero iniciamos sesi\u00f3n y aceptamos el \"License Agreement\". Luego elegimos el siguiente: Oracle Database 12c Release 1 (12.1.0.2.0) Enterprise Edition linux x86-64 File 1 (3.2 GB) Descomprimimos el zip: Abrimos consola y nos situamos en el directorio de la descarga: 1 2 cd Descargas unzip linuxx64_12102_database.zip Pasamos lo descomprimido a la m\u00e1quina virtual: Aparecer\u00e1 una carpeta database , esa carpeta la copiaremos mediante scp a la m\u00e1quina virtual: 1 scp -r database/ oracle@192.168.1.25:","title":"Descargas de Oracle Database Software"},{"location":"blog/oracleinstall/#instalacion-de-oracle","text":"Ejecutaremos mediante ssh y X11forward el instalador de Oracle con entorno gr\u00e1fico: 1 2 ssh -XC oracle@192.168.1.25 database/runInstaller -IgnoreSysPreReqs La opci\u00f3n -IgnoreSysPreReqs es para que ignorar los prerequisitos del sistema. La opci\u00f3n -X ejecuta aplicaciones gr\u00e1ficas. La opci\u00f3n -C es para comprimir los datos de la conexi\u00f3n. Configurar Actualizaciones de Seguridad Demarcamos la casilla para recibir actualizaciones y continuamos con Siguiente > . Nos aparecer\u00e1 una ventana para decirnos que Oracle no est\u00e1 soportado para este sistema y que el instalador no realizar\u00e1 las comprobaciones de requisitos en el sistema, la ignoramos y continuamos diciendo S\u00ed . Seleccionar Opci\u00f3n de Instalaci\u00f3n Elegimos la opci\u00f3n para \"Crear y configurar base de datos\" ya que vamos a crear una nueva base de datos y continuamos con Siguiente > . Clase de Sistema Elegimos la opci\u00f3n \"Clase de Servidor\" y continuamos con Siguiente > . Opciones de Instalci\u00f3n de Grid Elegimos \"Instalaci\u00f3n de Base de Datos de Instancia \u00danica\" y continuamos con Siguiente > . Tipo de Instalaci\u00f3n Elegimos Avanzada para configurar mas a fondo. Idiomas Dejamos por defecto. Edici\u00f3n de Base de Datos Solo nos deja Enterprise Edition. Ubicaci\u00f3n de Instalaci\u00f3n Si tenemos bien definidas las variavles de entorno se configura autom\u00e1ticamente. Crear Inventario Si tenemos bien definidas las variavles de entorno se configura autom\u00e1ticamente. Tipo de COnfiguraci\u00f3n Para Uso General. Especificar Identificadores de Base de Datos Dejamos valores por defecto. Opciones de Configuraci\u00f3n En \"Juego de Caracteres\" elegimos \"Unicode\". Y en \"Esquemas de Ejemplo\" marcamos la casilla para crear la base de datos con esquemas de ejemplo. Almacenamiento en la base de datos Dejamos por defecto. Opciones de Gesti\u00f3n Saltamos este paso y continuamos con Siguiente > . Opciones de Recuperaci\u00f3n Saltamos este paso y continuamos con Siguiente > . Contrase\u00f1as de Esquemas Para mayor comodidad usamos la misma contrase\u00f1a para todas las cuentas. Adem\u00e1s Oracle recomienda una contrase\u00f1a de al menos 8 caracteres, al menos una en may\u00fascula, otra en min\u00fascula y al menos un car\u00e1cter alfanum\u00e9rico. Grupos del Sistema Operativo con privilegios Dejamos por defecto. Resumen de Instalaci\u00f3n Aqu\u00ed vemos la configuraci\u00f3n final de la instalaci\u00f3n para poder comprobar si tenemos alg\u00fan error. Seleccionamos \"Instalar\". Instalar Producto Este paso tardar\u00e1 algunos minutos. Ejecutar Scripts de Configuraci\u00f3n Finalizando la instalaci\u00f3n Oracle nos pide que ejecutemos unos scripts como ROOT: 1 2 /opt/oraInventory/orainstRoot.sh /opt/oracle/product/12.2.0/dbhome_1/root.sh Asistente de Configuraci\u00f3n de base de Datos Al finalizar la ejecuci\u00f3n de los scripts pulsamos Aceptar y comenzar\u00e1 el proceso de creaci\u00f3n de la base de datos que tardar\u00e1 a\u00fan mas tiempo que la instalaci\u00f3n del software. As\u00ed que a esperar... Fin Configuraci\u00f3n Pasados bastantes minutos Oracle nos muestra alguna informaci\u00f3n de la base de datos como la URL de \"Enterprise Manager Database Express\" en: 1 https://localhost:5500/em Para acceder a dicha aplicaci\u00f3n web necesitaremos tener instalado Adobe Flash Player y aceptar la excepci\u00f3n de seguridad de esa p\u00e1gina. Los accesos desde otras redes est\u00e1n abiertas por defecto. https://192.168.1.25:5500/em Aceptamos. Fin de la instalaci\u00f3n","title":"Instalaci\u00f3n de Oracle"},{"location":"blog/oracleinstall/#accediendo-a-la-base-de-datos","text":"El acceso a la base de datos lo realizaremos mediante l\u00ednea de comandos con \"sqlplus\". Podemos instalar un paquete que nos ayudar\u00e1 con un uso mas amigable de \"sqlplus\": 1 apt install rlwrap Accedemos a la base de datos: 1 rlwrap sqlplus sys/PASS as sysdba Ejecutamos consulta para ver la versi\u00f3n de Oracle: 1 select * from v$version ; Para poder crear usuarios ejecutamos lo siguiente: alter session set \"_ORACLE_SCRIPT\"=true; -\\ \\ \\ \\ \\ \\ -\u00d3 echo 'alter session set \"_ORACLE_SCRIPT\"=true;' >> $ORACLE_HOME/sqlplus/admin/glogin.sql","title":"Accediendo a la base de datos"},{"location":"blog/oracleinstall/#iniciacion-de-la-base-de-datos","text":"Por defecto si reinicio la m\u00e1quina no arranca oracle asi que de momento la arrancaremos manualmente: Estado del Listener 1 lsnrctl status Arrancamos el Listener: 1 lsnrctl start Arrancamos la base de datos: 1 sqlplus / as sysdba 1 startup","title":"Iniciaci\u00f3n de la base de datos"},{"location":"blog/oracleinstall/#configuracion-acceso-remoto-oracle","text":"Si necesitamos acceder mediante la red seguiremos los siguientes pasos: Editamos la configuraci\u00f3n del \"Listener\" de oracle en $ORACLE_HOME/network/admin/listener.ora : 1 nano $ORACLE_HOME /network/admin/listener.ora Dejamos el fichero tal que as\u00ed para que puedan acceder desde cualquier red: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 SID_LIST_LISTENER = ( SID_LIST = ( SID_DESC = ( GLOBAL_DBNAME = orcl ) ( ORACLE_HOME = /opt/oracle/product/12.1.0.2/dbhome_1 ) ( SID_NAME = orcl ) ) ) LISTENER = ( DESCRIPTION_LIST = ( DESCRIPTION = ( ADDRESS_LIST = ( ADDRESS = ( PROTOCOL = IPC )( KEY = EXTPROC1521 )) ) ( ADDRESS_LIST = ( ADDRESS = ( PROTOCOL = TCP )( HOST = 0 .0.0.0 )( PORT = 1521 )) ) ) ) Reiniciamos el \"Listener\" con: 1 2 lsnrctl stop lsnrctl start","title":"Configuraci\u00f3n acceso remoto Oracle"},{"location":"blog/oracleinstall/#instalacion-de-cliente-sqlplus-remoto","text":"Lo primero ser\u00e1 instalar alien el cual nos permite reempaquetar un fichero .rpm en .deb : 1 apt install alien Luego nos descargamos los ficheros RPM necesarios de la p\u00e1gina de Oracle Aceptamos los t\u00e9rminos y elegimos los siguientes paquetes: -- Version 12.1.0.2.0 -- oracle-instantclient12.1-basic-12.1.0.2.0-1.x86_64.rpm oracle-instantclient12.1-sqlplus-12.1.0.2.0-1.x86_64.rpm oracle-instantclient12.1-devel-12.1.0.2.0-1.x86_64.rpm Reempaquetamos: 1 alien --to-deb --scripts oracle-instantclient12.1-*.rpm Instalamos los paquetes generados: 1 dpkg -i oracle-instantclient12.1-*.rpm A\u00f1adimos la variabe de entorno necesaria: 1 2 3 echo ''' export LD_LIBRARY_PATH=/usr/lib/oracle/12.1/client64/lib/:$LD_LIBRARY_PATH ''' >> /etc/bash.bashrc Ya podemos usar SQLPlus remotamente: 1 sqlplus64 system/PASS@//192.168.1.25:1521/orcl Y con esto y un bizcocho se acab\u00f3 Oracle!! De momento...","title":"Instalaci\u00f3n de Cliente SQLPlus remoto"},{"location":"blog/oracleinstall/#enlaces-de-interes","text":"Oracle Oficial Wiki Debian debian-administration oracle-base dbaora gemsofprogramming Oracle Oficial 10g Blog juanjo Blog Aitor","title":"Enlaces de Inter\u00e9s"},{"location":"blog/plpgsql/","text":"PL/SQL vs PL/PGSQL \u00b6 En este post veremos las principales diferencias entre la programaci\u00f3n en PL/SQL de Oracle y PL/PGSQL de Postgres. Triggers \u00b6 Las principales diferencias encontradas a la hora de escribir un programa en PL/SQL y PL/PGSQL radica a la hora de crear un trigger. Mientras que en PL/SQL tendr\u00eda la siguiente estructura: 1 2 3 4 5 6 7 CREATE OR REPLACE TRIGGER nombretrigger ( AFTER / BEFORE ) ( INSERT , UPDATE OR DELETE ) ON tabla FOR EACH ( fila o sentencia ) BEGIN ... END ; / En PL/PGSQL, no existe el trigger como tal, sino que creamos una funci\u00f3n que har\u00e1 lo que deseemos que haga el trigger y posteriormente crearemos un trigger para llamar a esa funci\u00f3n y le dir\u00e1 cuando actuar. La estructura quedar\u00eda de la siguiente manera: Funci\u00f3n: 1 2 3 4 5 6 7 CREATE OR REPLACE FUNCTIO nombrefuncion RETURNS TRIGGER AS $ nombretrigger$ DECLARE ... BEGIN ... END ; $ nombretrigger$ LANGUAGE PLPGSQL Trigger: 1 2 3 4 CREATE OR REPLACE nombretrigger ( AFTER OR BEFORE )( INSERT , UPDATE OR DELETE ) ON tabla FOR EACH ( FILA O SENTENCIA ) EXECUTE FUNCTION nombrefuncion ; Cursores \u00b6 Por otro lado, tambi\u00e9n cambia la forma de recorrer un CURSOR con un FOR. Mientras que en PL/SQL se crea el CURSOR y luego se recorre: 1 2 3 4 5 6 7 8 9 CURSOR c_cursor IS SELECT campo1 , campo2 FROM tabla ; ... FOR i IN c_cursor LOOP ... END LOOP ; En PL/PGSQL ser\u00eda: 1 2 3 FOR c_cursor IN SELECT campo1 , campo2 FROM tabla LOOP ; ... END LOOP ; \u00b6 Por \u00faltimo, aunque un poco menos importante, a la hora de crear funciones, el \"IS\" para declarar variables y cursores en PL/SQL, es sustituido por \"DECLARE\" en PL/PGSQL.","title":"PL/SQL vs PL/PGSQL"},{"location":"blog/plpgsql/#plsql-vs-plpgsql","text":"En este post veremos las principales diferencias entre la programaci\u00f3n en PL/SQL de Oracle y PL/PGSQL de Postgres.","title":"PL/SQL vs PL/PGSQL"},{"location":"blog/plpgsql/#triggers","text":"Las principales diferencias encontradas a la hora de escribir un programa en PL/SQL y PL/PGSQL radica a la hora de crear un trigger. Mientras que en PL/SQL tendr\u00eda la siguiente estructura: 1 2 3 4 5 6 7 CREATE OR REPLACE TRIGGER nombretrigger ( AFTER / BEFORE ) ( INSERT , UPDATE OR DELETE ) ON tabla FOR EACH ( fila o sentencia ) BEGIN ... END ; / En PL/PGSQL, no existe el trigger como tal, sino que creamos una funci\u00f3n que har\u00e1 lo que deseemos que haga el trigger y posteriormente crearemos un trigger para llamar a esa funci\u00f3n y le dir\u00e1 cuando actuar. La estructura quedar\u00eda de la siguiente manera: Funci\u00f3n: 1 2 3 4 5 6 7 CREATE OR REPLACE FUNCTIO nombrefuncion RETURNS TRIGGER AS $ nombretrigger$ DECLARE ... BEGIN ... END ; $ nombretrigger$ LANGUAGE PLPGSQL Trigger: 1 2 3 4 CREATE OR REPLACE nombretrigger ( AFTER OR BEFORE )( INSERT , UPDATE OR DELETE ) ON tabla FOR EACH ( FILA O SENTENCIA ) EXECUTE FUNCTION nombrefuncion ;","title":"Triggers"},{"location":"blog/plpgsql/#cursores","text":"Por otro lado, tambi\u00e9n cambia la forma de recorrer un CURSOR con un FOR. Mientras que en PL/SQL se crea el CURSOR y luego se recorre: 1 2 3 4 5 6 7 8 9 CURSOR c_cursor IS SELECT campo1 , campo2 FROM tabla ; ... FOR i IN c_cursor LOOP ... END LOOP ; En PL/PGSQL ser\u00eda: 1 2 3 FOR c_cursor IN SELECT campo1 , campo2 FROM tabla LOOP ; ... END LOOP ;","title":"Cursores"},{"location":"blog/postgresclient/","text":"Acceso remoto a servidor Postgresql \u00b6 En esta ocasi\u00f3n veremos de forma sencilla conectarnos a un servidor remoto de postgresql. Instalaci\u00f3n cliente Postgresql \u00b6 1 sudo apt install postgresql-client-9.6 Conexion remota \u00b6 1 psql -h 172 .22.200.63 -U prueba -d prueba2 Donde: -h es la ip del servidor. -U es el usuario con el que accedemos. -d es el nombre de la base de datos a la que nos conectamos. Pruebas de conexi\u00f3n \u00b6 Aqu\u00ed vemos que la conexi\u00f3n est\u00e1 establecida: Ejecutamos varios consultas como ver las tablas o ver los campos de una tabla:","title":"Acceso remoto Postgresql"},{"location":"blog/postgresclient/#acceso-remoto-a-servidor-postgresql","text":"En esta ocasi\u00f3n veremos de forma sencilla conectarnos a un servidor remoto de postgresql.","title":"Acceso remoto a servidor Postgresql"},{"location":"blog/postgresclient/#instalacion-cliente-postgresql","text":"1 sudo apt install postgresql-client-9.6","title":"Instalaci\u00f3n cliente Postgresql"},{"location":"blog/postgresclient/#conexion-remota","text":"1 psql -h 172 .22.200.63 -U prueba -d prueba2 Donde: -h es la ip del servidor. -U es el usuario con el que accedemos. -d es el nombre de la base de datos a la que nos conectamos.","title":"Conexion remota"},{"location":"blog/postgresclient/#pruebas-de-conexion","text":"Aqu\u00ed vemos que la conexi\u00f3n est\u00e1 establecida: Ejecutamos varios consultas como ver las tablas o ver los campos de una tabla:","title":"Pruebas de conexi\u00f3n"}]}